{"version":3,"names":["sallaFiltersCss","SallaFilters","constructor","hostRef","this","isReady","salla","event","on","host","style","display","lang","onLoaded","apply","get","reset","filters","freshFilterData","map","filter","label","category_id","brand_id","rating","price_range","key","inputType","FilterOptionInputType","CHECKBOX","RADIO","max","min","values","stars","filtersData","connectedCallback","URLSearchParams","window","location","search","JSON","parse","decodeURIComponent","e","logger","warn","message","async","scrollTo","top","behavior","setTimeout","history","pushState","url","addParamToUrl","encodeURIComponent","stringify","emit","changed","childNodes","forEach","widget","applyFilters","handleOptionChange","option","value","type","FilterOptionTypes","RANGE","isChecked","target","checked","push","val","render","h","Host","_a","onChanged","detail","_b","length","class","color","onClick","fill","resetFilters","componentDidLoad"],"sources":["./src/components/salla-filters/salla-filters.scss?tag=salla-filters","./src/components/salla-filters/salla-filters.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n.s-rating-stars-small {\n  line-height: 12px;\n}\n.s-filters-radio{\n  background-image: none !important;\n}","import { Component, Element, h, Event, EventEmitter, Host, Method, Prop, State } from '@stencil/core';\nimport { Filter, FilterOptionInputType, FilterOptionTypes } from \"./interfaces\";\n\n//todo::\n\n\n@Component({\n  tag: 'salla-filters',\n  styleUrl: 'salla-filters.scss',\n})\nexport class SallaFilters {\n\n  constructor() {\n    salla.event.on('filters::hidden', () => this.host.style.display = 'none');\n\n    salla.lang.onLoaded(() => {\n      this.apply = salla.lang.get('pages.checkout.apply');\n      this.reset = salla.lang.get('pages.categories.filters_reset');\n    });\n\n    salla.event.on('filters::fetched', ({ filters }) => {\n      this.host.style.display = '';\n      let freshFilterData = {};\n      this.filters = filters\n        .map((filter: Filter) => {\n          filter.label = {\n            category_id: salla.lang.get('common.titles.categories'),\n            brand_id: salla.lang.get('common.titles.brands'),\n            rating: salla.lang.get('pages.categories.filter_rating'),\n            price_range: salla.lang.get('pages.categories.filter_price'),\n          }[filter.key] || filter.label;\n          filter.inputType = FilterOptionInputType.CHECKBOX;\n          if (filter.key == 'rating') {\n            filter.inputType = FilterOptionInputType.RADIO;\n            //@ts-ignore\n            let { max, min } = filter.values;\n            //@ts-ignore\n            filter.values = [5, 4, 3, 2, 1].filter(stars => stars >= min || stars <= max)\n          }\n\n          //when getting new filters, maybe less than we had, so let's get from the old one, only what is existed now.\n          if (this.filtersData[filter.key]) {\n            freshFilterData[filter.key] = this.filtersData[filter.key];\n          }\n\n          return filter;\n        });\n      this.filtersData = freshFilterData;\n    });\n  }\n\n  connectedCallback() {\n    try {\n      let filters = (new URLSearchParams(window.location.search)).get('filters')\n      this.filtersData = filters ? JSON.parse(decodeURIComponent(filters)) : {};\n    } catch (e) {\n      salla.logger.warn('failed to get filters from url', e.message);\n    }\n  }\n\n  @Element() host: HTMLElement;\n  @Prop({ reflect: true, mutable: true }) filters?: Filter[];\n  private isReady = false;//to avoid triggering the changed event\n  @State() isSidebarOpen: boolean;\n  @State() filtersData: object = {}\n  @State() apply: string;\n  @State() reset: string;\n  @Event() changed: EventEmitter;\n\n  //TODO:: move all @methods into one section\n  @Method()\n  async getFilters() {\n    return this.filtersData;\n  }\n\n  @Method()\n  async applyFilters() {\n    if (!this.isReady) {\n      return;\n    }\n    //todo:: why we need thisðŸ¤”\n    window.scrollTo({top: 0,behavior: 'smooth'});\n    setTimeout(() => {\n      window.history.pushState({}, '', salla.url.addParamToUrl('filters', encodeURIComponent(JSON.stringify(this.filtersData))));\n      salla.event.emit('salla-filters::changed', this.filtersData);\n      this.changed.emit(this.filtersData);\n    }, 300);\n  }\n\n  @Method()\n  async resetFilters() {\n    this.filtersData = {};\n    this.host.childNodes.forEach((widget: HTMLSallaFiltersWidgetElement) => widget.reset && widget.reset())\n    salla.event.emit('salla-filters::reset');\n    return this.applyFilters();\n  }\n\n  /**\n   * @param {{target:HTMLInputElement}} event\n   * @param option\n   * @param value\n   * @private\n   */\n  private handleOptionChange(event, option: Filter, value) {\n    if (option.type === FilterOptionTypes.RANGE) {\n      this.filtersData[option.key] = value;\n      return;\n    }\n    let isChecked = event.target.checked;\n    if (event.target.type == FilterOptionInputType.RADIO) {\n      isChecked && (this.filtersData[option.key] = value);\n      isChecked || (delete this.filtersData[option.key]);\n      return;\n    }\n\n    //it's checkbox\n    this.filtersData[option.key] = this.filtersData[option.key] || [];\n    if (isChecked) {\n      this.filtersData[option.key].push(value);\n      return;\n    }\n    this.filtersData[option.key] = this.filtersData[option.key].filter(val => val != value);\n  }\n\n  render() {\n    return <Host>\n      {this.filters?.map(option => <salla-filters-widget\n        option={option}\n        filtersData={this.filtersData}\n        onChanged={({ detail: { event, option, value } }) => this.handleOptionChange(event, option, value)} />)}\n\n      {this.filters?.length && <div class=\"s-filters-footer\">\n        <salla-button color='primary' onClick={() => this.applyFilters()}>{this.apply}</salla-button>\n        <salla-button color='gray' fill='outline' onClick={() => this.resetFilters()}>{this.reset}</salla-button>\n      </div>}\n    </Host>;\n  }\n\n  componentDidLoad() {\n    this.isReady = true;\n  }\n}\n\n"],"mappings":"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"}