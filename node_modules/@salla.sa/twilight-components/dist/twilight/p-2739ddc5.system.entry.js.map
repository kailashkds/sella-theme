{"version":3,"names":["sallaFiltersCss","SallaFilters","exports","class_1","hostRef","_this","this","isReady","salla","event","on","host","style","display","lang","onLoaded","apply","get","reset","_c","filters","freshFilterData","map","filter","label","category_id","brand_id","rating","price_range","key","inputType","FilterOptionInputType","CHECKBOX","RADIO","values","max_1","max","min_1","min","stars","filtersData","prototype","connectedCallback","URLSearchParams","window","location","search","JSON","parse","decodeURIComponent","e","logger","warn","message","getFilters","applyFilters","scrollTo","top","behavior","setTimeout","history","pushState","url","addParamToUrl","encodeURIComponent","stringify","emit","changed","resetFilters","childNodes","forEach","widget","handleOptionChange","option","value","type","FilterOptionTypes","RANGE","isChecked","target","checked","push","val","render","h","Host","_a","onChanged","_d","detail","_b","length","class","color","onClick","fill","componentDidLoad"],"sources":["src/components/salla-filters/salla-filters.scss?tag=salla-filters","src/components/salla-filters/salla-filters.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n.s-rating-stars-small {\n  line-height: 12px;\n}\n.s-filters-radio{\n  background-image: none !important;\n}","import { Component, Element, h, Event, EventEmitter, Host, Method, Prop, State } from '@stencil/core';\nimport { Filter, FilterOptionInputType, FilterOptionTypes } from \"./interfaces\";\n\n//todo::\n\n\n@Component({\n  tag: 'salla-filters',\n  styleUrl: 'salla-filters.scss',\n})\nexport class SallaFilters {\n\n  constructor() {\n    salla.event.on('filters::hidden', () => this.host.style.display = 'none');\n\n    salla.lang.onLoaded(() => {\n      this.apply = salla.lang.get('pages.checkout.apply');\n      this.reset = salla.lang.get('pages.categories.filters_reset');\n    });\n\n    salla.event.on('filters::fetched', ({ filters }) => {\n      this.host.style.display = '';\n      let freshFilterData = {};\n      this.filters = filters\n        .map((filter: Filter) => {\n          filter.label = {\n            category_id: salla.lang.get('common.titles.categories'),\n            brand_id: salla.lang.get('common.titles.brands'),\n            rating: salla.lang.get('pages.categories.filter_rating'),\n            price_range: salla.lang.get('pages.categories.filter_price'),\n          }[filter.key] || filter.label;\n          filter.inputType = FilterOptionInputType.CHECKBOX;\n          if (filter.key == 'rating') {\n            filter.inputType = FilterOptionInputType.RADIO;\n            //@ts-ignore\n            let { max, min } = filter.values;\n            //@ts-ignore\n            filter.values = [5, 4, 3, 2, 1].filter(stars => stars >= min || stars <= max)\n          }\n\n          //when getting new filters, maybe less than we had, so let's get from the old one, only what is existed now.\n          if (this.filtersData[filter.key]) {\n            freshFilterData[filter.key] = this.filtersData[filter.key];\n          }\n\n          return filter;\n        });\n      this.filtersData = freshFilterData;\n    });\n  }\n\n  connectedCallback() {\n    try {\n      let filters = (new URLSearchParams(window.location.search)).get('filters')\n      this.filtersData = filters ? JSON.parse(decodeURIComponent(filters)) : {};\n    } catch (e) {\n      salla.logger.warn('failed to get filters from url', e.message);\n    }\n  }\n\n  @Element() host: HTMLElement;\n  @Prop({ reflect: true, mutable: true }) filters?: Filter[];\n  private isReady = false;//to avoid triggering the changed event\n  @State() isSidebarOpen: boolean;\n  @State() filtersData: object = {}\n  @State() apply: string;\n  @State() reset: string;\n  @Event() changed: EventEmitter;\n\n  //TODO:: move all @methods into one section\n  @Method()\n  async getFilters() {\n    return this.filtersData;\n  }\n\n  @Method()\n  async applyFilters() {\n    if (!this.isReady) {\n      return;\n    }\n    //todo:: why we need thisðŸ¤”\n    window.scrollTo({top: 0,behavior: 'smooth'});\n    setTimeout(() => {\n      window.history.pushState({}, '', salla.url.addParamToUrl('filters', encodeURIComponent(JSON.stringify(this.filtersData))));\n      salla.event.emit('salla-filters::changed', this.filtersData);\n      this.changed.emit(this.filtersData);\n    }, 300);\n  }\n\n  @Method()\n  async resetFilters() {\n    this.filtersData = {};\n    this.host.childNodes.forEach((widget: HTMLSallaFiltersWidgetElement) => widget.reset && widget.reset())\n    salla.event.emit('salla-filters::reset');\n    return this.applyFilters();\n  }\n\n  /**\n   * @param {{target:HTMLInputElement}} event\n   * @param option\n   * @param value\n   * @private\n   */\n  private handleOptionChange(event, option: Filter, value) {\n    if (option.type === FilterOptionTypes.RANGE) {\n      this.filtersData[option.key] = value;\n      return;\n    }\n    let isChecked = event.target.checked;\n    if (event.target.type == FilterOptionInputType.RADIO) {\n      isChecked && (this.filtersData[option.key] = value);\n      isChecked || (delete this.filtersData[option.key]);\n      return;\n    }\n\n    //it's checkbox\n    this.filtersData[option.key] = this.filtersData[option.key] || [];\n    if (isChecked) {\n      this.filtersData[option.key].push(value);\n      return;\n    }\n    this.filtersData[option.key] = this.filtersData[option.key].filter(val => val != value);\n  }\n\n  render() {\n    return <Host>\n      {this.filters?.map(option => <salla-filters-widget\n        option={option}\n        filtersData={this.filtersData}\n        onChanged={({ detail: { event, option, value } }) => this.handleOptionChange(event, option, value)} />)}\n\n      {this.filters?.length && <div class=\"s-filters-footer\">\n        <salla-button color='primary' onClick={() => this.applyFilters()}>{this.apply}</salla-button>\n        <salla-button color='gray' fill='outline' onClick={() => this.resetFilters()}>{this.reset}</salla-button>\n      </div>}\n    </Host>;\n  }\n\n  componentDidLoad() {\n    this.isReady = true;\n  }\n}\n\n"],"mappings":"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"}