{"version":3,"names":["sallaFiltersWidgetCss","SallaFiltersWidget","this","initHeight","connectedCallback","withLoadMore","Array","isArray","option","values","length","widgetTitle","label","componentDidLoad","widgetValues","scrollHeight","style","maxHeight","widgetContent","height","async","type","FilterOptionTypes","RANGE","priceRange","reset","from","host","querySelectorAll","forEach","input","checked","isShowMore","setTimeout","isOpen","Helper","toggleElementClassIf","renderFilterOption","VALUES","MINIMUM","VARIANTS","includes","map","filterOption","index","value","key","h","class","htmlFor","id","name","inputType","isSelectedOption","onChange","e","changed","emit","event","getOptionLabel","filtersData","FilterOptionInputType","CHECKBOX","size","render","Host","onClick","toggleWidget","ref","el","onChanged","detail","price","showMore"],"sources":["./src/components/salla-filters-widget/salla-filters-widget.scss?tag=salla-filters-widget","./src/components/salla-filters-widget/salla-filters-widget.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n","import {Component, Host, h, Method, State, Prop, Event, Element} from '@stencil/core';\nimport Helper from '../../Helpers/Helper';\nimport {Filter, FilterOptionInputType, FilterOptionTypes} from \"../salla-filters/interfaces\";\n\n@Component({\n  tag: 'salla-filters-widget',\n  styleUrl: 'salla-filters-widget.scss',\n})\nexport class SallaFiltersWidget {\n  @Element() host: HTMLElement;\n  @Prop({mutable: true}) widgetTitle: string;\n  @Prop({mutable: true}) withLoadMore: boolean;\n  @Prop({reflect: true}) filtersData: object;\n  @Prop({reflect: true}) option: Filter;\n  priceRange: HTMLSallaPriceRangeElement\n\n\n  private widgetValues: HTMLElement;\n  private widgetContent: HTMLDivElement;\n  private initHeight: number = 195;\n  @State() isOpen: boolean = true;\n  @State() isShowMore: boolean = false;\n\n  @Event() changed: any;\n\n  connectedCallback() {\n    //lets be smart and don't show 5 and more link for 8 options\n    this.withLoadMore = Array.isArray(this.option.values) && this.option.values.length > 8;\n    this.widgetTitle = this.option.label;\n  }\n\n  componentDidLoad() {\n    this.widgetValues.scrollHeight < this.initHeight && (this.withLoadMore = false);\n    (this.withLoadMore && this.widgetValues) && (this.widgetValues.style.maxHeight = `${this.initHeight}px`);\n    this.widgetContent.style.height = `${this.widgetContent.scrollHeight}px`;\n  }\n\n  @Method()\n  async reset() {\n    if (this.option.type === FilterOptionTypes.RANGE) {\n      this.priceRange.reset()\n    }\n    Array.from(this.host.querySelectorAll('input')).forEach(input => input.checked = false);\n  }\n\n\n  @Method()\n  async showMore() {\n    this.isShowMore = !this.isShowMore\n    this.widgetContent.style.height = 'auto';\n    this.widgetValues.style.maxHeight = this.isShowMore ? `${this.widgetValues.scrollHeight}px` : `${this.initHeight}px`;\n    setTimeout(() => {\n      this.widgetContent.style.height = `${this.widgetContent.scrollHeight}px`;\n    }, 400); // get height after time of collapse animtion (duration-300)\n  }\n\n  @Method()\n  async toggleWidget() {\n    this.isOpen = !this.isOpen;\n    Helper.toggleElementClassIf(this.widgetContent, 's-filters-widget-opened', 's-filters-widget-closed', () => this.isOpen);\n  }\n\n  renderFilterOption(option: Filter) {\n    if (![FilterOptionTypes.VALUES, FilterOptionTypes.MINIMUM, FilterOptionTypes.VARIANTS].includes(option.type)) {\n      return '';\n    }\n    //@ts-ignore\n    return option.values.map((filterOption, index) => {\n        let value = typeof filterOption == 'number' ? filterOption : (filterOption.key || filterOption.value);\n\n        return <label class=\"s-filters-label\" htmlFor={`${option.key}-option-${index}`}>\n          <input\n            id={`${option.key}-option-${index}`}\n            name={option.key}\n            type={option.inputType}\n            //TODO:: debug more why sometimes it's not rendered as selectedðŸ¤¨\n            checked={this.isSelectedOption(option, value)}\n            class={`s-filters-${option.inputType}`}\n            onChange={e => this.changed.emit({event: e, option: option, value: value})}\n          />\n          {this.getOptionLabel(option, filterOption)}\n        </label>\n      }\n    )\n  }\n\n  private isSelectedOption(option: Filter, value) {\n    if (!this.filtersData || !this.filtersData[option.key]) {\n      return false\n    }\n\n    return option.inputType === FilterOptionInputType.CHECKBOX\n      ? this.filtersData[option.key].includes(value)\n      : this.filtersData[option.key] == value;\n  }\n\n  private getOptionLabel(option: Filter, filterOption) {\n    if (option.key == 'rating') {\n      //in amazon has stars & up, should we add it, to avoid those people who will come to say I selected 4 why I see 5 sars products\n      return <salla-rating-stars size=\"small\" value={filterOption}/>;\n    }\n    let label = filterOption.value || 'null';\n    //label+=filterOption.count ? ` (${salla.helpers.number(filterOption.count)})` : '';\n    return <span class=\"s-filters-option-name\">{label}</span>;\n  }\n\n  render() {\n    return (\n      <Host class=\"s-filters-widget-container\">\n        <h3 class=\"s-filters-widget-title\" onClick={() => this.toggleWidget()}>\n          <span>{this.widgetTitle}</span>\n          <span class={`s-filters-widget-plusminus ${this.isOpen ? 's-filters-widget-plusminus-active' : ''}`}/>\n        </h3>\n        <div class=\"s-filters-widget-content\" ref={(el) => this.widgetContent = el}>\n          <div class=\"s-filters-widget-values\" ref={(el) => this.widgetValues = el}>\n            <slot/>\n            {\n              this.option.type !== FilterOptionTypes.RANGE\n                ? this.renderFilterOption(this.option)\n                : <salla-price-range onChanged={(event) => this.changed.emit(event.detail)}\n                                     ref={price => this.priceRange = price}\n                                     filtersData={this.filtersData}\n                                     option={this.option}/>\n            }\n          </div>\n          {this.withLoadMore &&\n          <a class=\"s-filters-widget-more\"\n             onClick={() => this.showMore()}>{!this.isShowMore ? 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯' : 'Ø¹Ø±Ø¶ Ø£Ù‚Ù„'}</a>\n          }\n        </div>\n      </Host>\n    );\n  }\n\n}\n"],"mappings":"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"}