{"version":3,"names":["sallaProductsSliderCss","SallaProductsSlider","constructor","hostRef","salla","onReady","this","sourceValueIsValid","sourceValue","includes","getSource","logger","warn","hasCustomComponent","customElements","get","getItemHTML","product","h","class","source","getSourceValue","getUrlPrefix","urlPrefix","limit","getApiUrl","prefixes","url","api","join","e","config","Array","isArray","JSON","parse","length","canRender","isReady","componentWillLoad","productsData","request","then","res","data","render","Host","id","sliderId","Math","random","toString","substr","type","blockTitle","subTitle","displayAllUrl","slot","_a","map"],"sources":["./src/components/salla-products-slider/salla-products-slider.scss?tag=salla-products-slider","./src/components/salla-products-slider/salla-products-slider.tsx"],"sourcesContent":[".s-products-slider{\n  &-wrapper{\n\n  }\n  &-slider{\n\n  }\n  &-card{\n\n  }\n}","import {Component, Host, h, Prop, Element, State} from '@stencil/core';\n\n@Component({\n  tag: 'salla-products-slider',\n  styleUrl: 'salla-products-slider.scss'\n})\nexport class SallaProductsSlider {\n  constructor() {\n    salla.onReady(() => {\n      this.sourceValueIsValid = !!(this.sourceValue || ['latest', 'offers'].includes(this.getSource()));\n    });\n    if (!this.sourceValueIsValid) {\n      salla.logger.warn(`source-value prop is required for source [${this.getSource()}]`);\n      return;\n    }\n    this.hasCustomComponent = !!customElements.get('custom-salla-product-card');\n  }\n\n  @Element() host: HTMLElement;\n  //todo:: support limit, default =10, make sure that maximum is 32,\n\n  /**\n   * Title of the block - works only if slider is true\n   * @type {string}\n   * @default ''\n   * */\n  @Prop() blockTitle: string;\n\n  /**\n   * Sub title of the block - works only if slider is true\n   * @type {string}\n   * @default ''\n   * */\n  @Prop() subTitle: string;\n\n  /**\n   * Slider Id, if not provided will be generated automatically\n   * @type {string}\n   * @default ''\n   * */\n  @Prop() sliderId: string;\n\n  /**\n   * Display 'ALL' URL\n   * @type {string}\n   * @default ''\n   * */\n  @Prop() displayAllUrl: string;\n\n  /**\n   * Source of the products, if api will get the products from the API, if json will get the products from the products prop\n   * @type {string}\n   * @default ''\n   * */\n  @Prop({\n    reflect: true,\n    mutable: true\n  }) source: 'categories' | 'latest' | 'related' | 'brands' | 'json' | 'tags' | 'selected' | 'offers' | 'landing-page';\n\n  /**\n   * The source value, cloud be different values as following:\n   * - array of ids when `source` in ['categories', 'brands', 'tags', 'selected']\n   * - products payload when `source` = 'json'\n   * - product_id when `source` = 'related'\n   *\n   * @type {string}\n   * */\n  @Prop() sourceValue: string;\n\n  /**\n  * Limit for number of products in the list.\n  */\n  @Prop({mutable: true}) limit: number;\n\n   \n  @State() productsData: any;\n  @State() isReady: boolean;\n  @State() sourceValueIsValid: boolean;\n  @State() hasCustomComponent: boolean;\n  @State() apiUrl: string = '';\n  @State() parsedSourceValue: any;\n\n  private getItemHTML(product) {\n    if (this.hasCustomComponent) {\n      return <div class=\"s-products-slider-card\">\n        <custom-salla-product-card product={product} source={this.getSource()} source-value={this.getSourceValue()}/>\n      </div>;\n    }\n\n    return <div class=\"s-products-slider-card\">\n      <salla-product-card\n        show-quantity={this.getSource() == 'landing-page'}\n        hide-add-btn={this.getSource() == 'landing-page'}\n        shadow-on-hover={true}\n        product={product}/>\n    </div>;\n  }\n\n  private getUrlPrefix() {\n    let urlPrefix = '';\n    if (this.limit) {\n      urlPrefix = `&per_page=${this.limit > 32 ? 32 : this.limit}`;\n    }\n    return urlPrefix;\n  }\n\n  getApiUrl() {\n    if (this.getSource() === 'json') {\n      return;\n    }\n    let prefixes = this.getUrlPrefix();\n    if (['offers', 'latest'].includes(this.getSource())) {\n      return salla.url.api(`products?source=${this.getSource()}${prefixes}`);\n    }\n    if (['related', 'landing-page'].includes(this.getSource())) {\n      return salla.url.api(`products?source=${this.getSource()}&source_value=${this.getSourceValue()}${prefixes}`);\n    }\n\n    try {\n      return salla.url.api(`products?source=${this.getSource()}&source_value[]=${this.getSourceValue().join('&source_value[]=')}${prefixes}`);\n    } catch (e) {\n      salla.logger.warn(`source-value prop should be array of ids ex source-value=\"[1,2,3]\" for the source [${this.getSource()}]`);\n      this.sourceValueIsValid = false;\n    }\n  }\n  private getSource(){\n    return {\n      'brands.single': 'brands',\n      'product.index': 'categories',\n      'product.index.latest': 'latest',\n      'product.index.offers': 'offers',\n      'product.index.search': 'search',\n      'landing-page': 'landing-page',\n      'product.index.tag': 'tags',\n    }[this.source || salla.config.get('page.slug')] || this.source ||'latest';\n  }\n\n  private getSourceValue() {\n     if (!['search', 'json'].includes(this.getSource())) {\n      if (Array.isArray(JSON.parse(this.sourceValue)) && JSON.parse(this.sourceValue).length) {\n        return JSON.parse(this.sourceValue);\n      }\n\n      if (typeof JSON.parse(this.sourceValue) == 'number') {\n        return [JSON.parse(this.sourceValue)];\n      }\n    }\n    return this.sourceValue || salla.config.get('page.id');\n  }\n  private canRender() {\n    return this.sourceValueIsValid && this.isReady;\n  }\n\n  componentWillLoad() {\n    if (this.source === 'json') {\n      this.productsData = this.getSourceValue();\n      this.isReady = true\n      return;\n    }\n    salla.api.request(this.getApiUrl(), null, 'get').then(res => {\n      this.productsData = res.data\n      this.isReady = true\n    })\n  }\n\n  render() {\n    if ((this.getSource() == 'related' && !salla.config.get('store.settings.product.related_products_enabled')) || !this.canRender()) {\n      return;\n    }\n    return (\n      <Host class=\"s-products-slider-wrapper\">\n        <salla-slider\n          class=\"s-products-slider-slider\"\n          id={this.sliderId || `s-products-slider-${Math.random().toString(36).substr(2, 9)}`}\n          type=\"carousel\"\n          block-title={this.blockTitle}\n          block-subTitle={this.subTitle}\n          display-all-url={this.displayAllUrl}\n        >\n          <div slot=\"items\">\n            {this.productsData?.map((product) =>\n              this.getItemHTML(product)\n            )}\n          </div>\n        </salla-slider>\n      </Host>\n    );\n  }\n\n}\n"],"mappings":"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"}