{"file":"salla-installment.entry.js","mappings":"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","names":[],"sources":["./src/components/salla-installment/salla-installment.scss?tag=salla-installment","./src/components/salla-installment/salla-installment.tsx"],"sourcesContent":["/*\n  The whole installment methods is a third-party widgets,\n  So there aren't a custom classes (as other components) to style them.\n*/\n\nsalla-installment:empty {\n  display: none;\n}\n/*\n* Installment::Tabby\n*/\n#tabbyPromoWrapper {\n  background: white;\n  border-radius: 0.375rem;\n  transition: box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n  margin-bottom: 20px;\n\n  .salla-y &{\n    border: 1px solid var(--color-grey-dark);\n    border-radius: 12px\n  }\n\n  &:hover{\n    box-shadow: 0 0 #0000, 0 0 #0000, 5px 10px 30px #2B2D340D;\n  }\n\n  #tabbyPromo {\n    * {\n      font-family: var(--font-main);\n    }\n\n    > div > div {\n      max-width: none;\n      //padding: 15px;\n      box-shadow: none;\n      border: none;\n    }\n\n    .tabby-promo-snippet {\n      max-width: 100%;\n      min-height: 100px;\n      padding: 18px 20px;\n      // border-color: var(--color-grey-dark);\n      border: none !important;\n\n\n      &__text, &__link {\n        font-size: var(--font-sm);\n        color: var(--color-text) !important;\n      }\n\n      &__link {\n        font-weight: bold;\n      }\n    }\n  }\n}\n\n.tabby-promo-wrapper {\n  #tabby-promo {\n    font-family: var(--font-main) !important;\n\n    .tabby-promo {\n      &__feature-title {\n        font-size: var(--font-md);\n      }\n\n      &__feature-desc {\n        font-size: var(--font-sm);\n        line-height: 20px;\n      }\n    }\n  }\n}\n\n/*\n* Installment::Tamara & Spotii\n*/\n.tamara-product-widget{\n  margin-bottom: 20px;\n}\n\n.tamara-product-widget,\n.spotii-wrapper {\n  min-height: 100px;\n  position: relative;\n  color: var(--color-text);\n  font-size: var(--font-sm);\n  line-height: 1.25;\n  padding: 18px 20px 18px 100px !important;\n  background: white;\n  border-radius: 0.375rem;\n  transition: box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n\n  .salla-y &{\n    border-radius: 12px;\n    border: 1px solid var(--color-grey-dark);\n  }\n\n  &:hover{\n    box-shadow: 0 0 #0000, 0 0 #0000, 5px 10px 30px #2B2D340D;\n  }\n  .spotii-logo {\n    float: left;\n    margin: 0 0 0 -75px;\n  }\n}\n.ltr .tamara-product-widget,\n.ltr .spotii-wrapper{\n  text-align: left;\n  padding: 18px 100px 18px 20px !important;\n  .spotii-logo {\n    float: right;\n    margin: 0 -75px 0 0;\n  }\n  .spotii-product-widget {\n    text-align: left !important;\n  }\n}\n\n.spotii-wrapper {\n  margin-bottom: 20px;\n  .spotii-promo {\n    font-size: var(--font-md);\n  }\n\n  .spotii-product-widget {\n    font-size: var(--font-sm) !important;\n    margin-top: 10px;\n  }\n}\n\n.tamara-product-widget{\n  .tamara-logo {\n    position: absolute;\n    left: 20px;\n    top: 18px;\n    margin: 0 !important;\n\n    .ltr &{\n      right: 20px;\n      left: auto;\n    }\n  }\n\n  span {\n    font-family: var(--font-main);\n    font-size: var(--font-sm);\n    color: var(--color-text);\n\n    &:last-child {\n      display: block;\n      position: relative;\n      margin-top: 8px;\n    }\n  }\n}\n\n.tamara-popup {\n  &__wrap {\n    overflow: auto !important;\n  }\n}\n","import {Component, Host, h, Prop, State} from '@stencil/core';\n\n@Component({\n  tag: 'salla-installment',\n  styleUrl: 'salla-installment.scss',\n})\n\nexport class SallaInstallment {\n  private tabbyBorderRemoved: boolean = false;\n  private tabbyRemoveBorderTries: number = 0;\n\n  constructor() {\n    salla.lang.onLoaded(() => {\n      const installment = salla.config.get('store.settings.installments');\n      if (installment) {\n        this.tamaraIsActive = installment.includes('tamara_installment');\n        this.tabbyIsActive = installment.includes('tabby_installment');\n        this.spotiiIsActive = installment.includes('spotii_pay');\n      }\n      this.renderInstallments();\n    });\n  }\n\n  /**\n   * Current product price\n   */\n  @Prop() price: string;\n  /**\n   * Language code\n   */\n  @Prop() language: string = salla.config.get('user.language_code');\n  /**\n   * Currency code\n   */\n  @Prop() currency: string = salla.config.get('user.currency_code');\n\n  @State() tamaraIsActive: boolean;\n  @State() tabbyIsActive: boolean;\n  @State() spotiiIsActive: boolean;\n\n  render() {\n    return (\n      <Host>\n        {this.tamaraIsActive ?\n          <div class=\"tamara-product-widget\"\n               data-price={this.price}\n               data-currency={this.currency}\n               data-lang={this.language}\n               data-payment-type=\"installment\">\n          </div>\n          : ''}\n\n        {this.tabbyIsActive ?\n          <div id=\"tabbyPromoWrapper\">\n            <div id=\"tabbyPromo\"></div>\n          </div>\n          : ''}\n\n        {this.spotiiIsActive ?\n          <div class=\"spotii-wrapper\">\n            {/*No need for the price, the price already in the page, and also tammara & tabby doesn't have price */}\n            <div class=\"spotii-promo\"></div>\n          </div>\n          : ''}\n      </Host>\n    );\n  }\n\n  renderInstallments() {\n    // Tamara\n    if (this.tamaraIsActive) {\n      var script = document.createElement('script');\n      script.setAttribute('src', 'https://cdn.tamara.co/widget/product-widget.min.js');\n      document.head.appendChild(script);\n      script.onload = () => {\n        window.TamaraProductWidget.init({lang: this.language})\n        setTimeout(() => {\n          window.TamaraProductWidget.render()\n        }, 300)\n      }\n    }\n\n    // tabby\n    if (this.tabbyIsActive) {\n      var script = document.createElement('script');\n      script.setAttribute('src', 'https://checkout.tabby.ai/tabby-promo.js');\n      document.head.appendChild(script);\n      script.onload = () => {\n        const TabbyPromo = window.TabbyPromo;\n        new TabbyPromo({\n          selector: '#tabbyPromo',\n          currency: this.currency,\n          price: this.price,\n          lang: this.language,\n        });\n        document.querySelectorAll('.tabby-promo-snippet__logo').forEach(function (element) {\n          element.setAttribute('aria-label', 'Tabby Logo')\n        });\n      }\n      //this is workaround to remove the default border and add margin\n      this.removeTabbyBorder();\n    }\n\n    // Spotii\n    if (this.spotiiIsActive) {\n      let amount = salla.money((Number(this.price) / 3).toFixed(2));\n      let isRTL = salla.config.get('theme.is_rtl', true);\n      window.spotiiConfig = {\n        targetXPath: ['.spotii-wrapper'],\n        renderToPath: ['.spotii-promo'],\n        numberOfPayment: 3,\n        currency: this.currency,\n        templateLine: \"${textOne} ${number} ${textTwo} \" + amount + \"${logo} ${info}\",\n        //todo:: translate these\n        textOne: isRTL ? \"جزء الدفع على\" : \"Split it into\",\n        textTwo: isRTL ? \"أقساط متساوية بدون تكاليف اضافية بقيمة\" : \"payments of\",\n        textThree: \"مع\",\n        price: this.price,\n        // forcedShow: false,\n        // merchantID: null,\n      }\n\n      var script = document.createElement('script');\n\n      script.setAttribute('src', salla.url.cdn('js/price-widget-ar-salla.js'));\n      document.head.appendChild(script);\n      // script.onload = () => {\n      //   // setTimeout()\n      // }\n    }\n\n  }\n\n  /**\n   * this is workaround to remove the default border and add margin\n   * we will try to remove tabby border 5 times for 7.5 seconds\n   */\n  removeTabbyBorder() {\n    if (this.tabbyBorderRemoved || this.tabbyRemoveBorderTries > 5) {\n      return;\n    }\n    this.tabbyRemoveBorderTries++;\n    setTimeout(() => {\n      let promo: any = document.querySelector('#tabbyPromo>div>div');\n      promo = promo ? promo.shadowRoot.querySelector('div[class^=\"styles__tabby-promo-snippet--\"]') : null;\n      if (promo) {\n        promo.style = 'border: none; margin: 15px 0!important;';\n        this.tabbyBorderRemoved = true;\n      } else {\n        this.removeTabbyBorder();\n      }\n    }, this.tabbyRemoveBorderTries * 500)\n  }\n}\n"],"version":3}