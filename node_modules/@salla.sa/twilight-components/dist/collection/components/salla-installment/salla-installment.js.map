{"version":3,"file":"salla-installment.js","sourceRoot":"","sources":["../../../src/components/salla-installment/salla-installment.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAC,SAAS,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,KAAK,EAAC,MAAM,eAAe,CAAC;AAO9D,MAAM,OAAO,gBAAgB;EAI3B;IAHQ,uBAAkB,GAAY,KAAK,CAAC;IACpC,2BAAsB,GAAW,CAAC,CAAC;;oBAqBhB,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,oBAAoB,CAAC;oBAItC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,oBAAoB,CAAC;;;;IAtB/D,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE;MACvB,MAAM,WAAW,GAAG,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;MACpE,IAAI,WAAW,EAAE;QACf,IAAI,CAAC,cAAc,GAAG,WAAW,CAAC,QAAQ,CAAC,oBAAoB,CAAC,CAAC;QACjE,IAAI,CAAC,aAAa,GAAG,WAAW,CAAC,QAAQ,CAAC,mBAAmB,CAAC,CAAC;QAC/D,IAAI,CAAC,cAAc,GAAG,WAAW,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;OAC1D;MACD,IAAI,CAAC,kBAAkB,EAAE,CAAC;IAC5B,CAAC,CAAC,CAAC;GACJ;EAmBD,MAAM;IACJ,OAAO,CACL,EAAC,IAAI;MACF,IAAI,CAAC,cAAc,CAAC,CAAC;QACpB,WAAK,KAAK,EAAC,uBAAuB,gBACjB,IAAI,CAAC,KAAK,mBACP,IAAI,CAAC,QAAQ,eACjB,IAAI,CAAC,QAAQ,uBACN,aAAa,GAC9B;QACN,CAAC,CAAC,EAAE;MAEL,IAAI,CAAC,aAAa,CAAC,CAAC;QACnB,WAAK,EAAE,EAAC,mBAAmB;UACzB,WAAK,EAAE,EAAC,YAAY,GAAO,CACvB;QACN,CAAC,CAAC,EAAE;MAEL,IAAI,CAAC,cAAc,CAAC,CAAC;QACpB,WAAK,KAAK,EAAC,gBAAgB;UAEzB,WAAK,KAAK,EAAC,cAAc,GAAO,CAC5B;QACN,CAAC,CAAC,EAAE,CACD,CACR,CAAC;EACJ,CAAC;EAED,kBAAkB;IAChB,SAAS;IACT,IAAI,IAAI,CAAC,cAAc,EAAE;MACvB,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;MAC9C,MAAM,CAAC,YAAY,CAAC,KAAK,EAAE,oDAAoD,CAAC,CAAC;MACjF,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;MAClC,MAAM,CAAC,MAAM,GAAG,GAAG,EAAE;QACnB,MAAM,CAAC,mBAAmB,CAAC,IAAI,CAAC,EAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAC,CAAC,CAAA;QACtD,UAAU,CAAC,GAAG,EAAE;UACd,MAAM,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAA;QACrC,CAAC,EAAE,GAAG,CAAC,CAAA;MACT,CAAC,CAAA;KACF;IAED,QAAQ;IACR,IAAI,IAAI,CAAC,aAAa,EAAE;MACtB,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;MAC9C,MAAM,CAAC,YAAY,CAAC,KAAK,EAAE,0CAA0C,CAAC,CAAC;MACvE,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;MAClC,MAAM,CAAC,MAAM,GAAG,GAAG,EAAE;QACnB,MAAM,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC;QACrC,IAAI,UAAU,CAAC;UACb,QAAQ,EAAE,aAAa;UACvB,QAAQ,EAAE,IAAI,CAAC,QAAQ;UACvB,KAAK,EAAE,IAAI,CAAC,KAAK;UACjB,IAAI,EAAE,IAAI,CAAC,QAAQ;SACpB,CAAC,CAAC;QACH,QAAQ,CAAC,gBAAgB,CAAC,4BAA4B,CAAC,CAAC,OAAO,CAAC,UAAU,OAAO;UAC/E,OAAO,CAAC,YAAY,CAAC,YAAY,EAAE,YAAY,CAAC,CAAA;QAClD,CAAC,CAAC,CAAC;MACL,CAAC,CAAA;MACD,gEAAgE;MAChE,IAAI,CAAC,iBAAiB,EAAE,CAAC;KAC1B;IAED,SAAS;IACT,IAAI,IAAI,CAAC,cAAc,EAAE;MACvB,IAAI,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;MAC9D,IAAI,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;MACnD,MAAM,CAAC,YAAY,GAAG;QACpB,WAAW,EAAE,CAAC,iBAAiB,CAAC;QAChC,YAAY,EAAE,CAAC,eAAe,CAAC;QAC/B,eAAe,EAAE,CAAC;QAClB,QAAQ,EAAE,IAAI,CAAC,QAAQ;QACvB,YAAY,EAAE,kCAAkC,GAAG,MAAM,GAAG,iBAAiB;QAC7E,wBAAwB;QACxB,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,eAAe;QAClD,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC,wCAAwC,CAAC,CAAC,CAAC,aAAa;QACzE,SAAS,EAAE,IAAI;QACf,KAAK,EAAE,IAAI,CAAC,KAAK;QACjB,qBAAqB;QACrB,oBAAoB;OACrB,CAAA;MAED,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;MAE9C,MAAM,CAAC,YAAY,CAAC,KAAK,EAAE,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC,CAAC;MACzE,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;MAClC,0BAA0B;MAC1B,oBAAoB;MACpB,IAAI;KACL;EAEH,CAAC;EAED;;;KAGG;EACH,iBAAiB;IACf,IAAI,IAAI,CAAC,kBAAkB,IAAI,IAAI,CAAC,sBAAsB,GAAG,CAAC,EAAE;MAC9D,OAAO;KACR;IACD,IAAI,CAAC,sBAAsB,EAAE,CAAC;IAC9B,UAAU,CAAC,GAAG,EAAE;MACd,IAAI,KAAK,GAAQ,QAAQ,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;MAC/D,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,aAAa,CAAC,6CAA6C,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;MACrG,IAAI,KAAK,EAAE;QACT,KAAK,CAAC,KAAK,GAAG,yCAAyC,CAAC;QACxD,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;OAChC;WAAM;QACL,IAAI,CAAC,iBAAiB,EAAE,CAAC;OAC1B;IACH,CAAC,EAAE,IAAI,CAAC,sBAAsB,GAAG,GAAG,CAAC,CAAA;EACvC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import {Component, Host, h, Prop, State} from '@stencil/core';\n\n@Component({\n  tag: 'salla-installment',\n  styleUrl: 'salla-installment.scss',\n})\n\nexport class SallaInstallment {\n  private tabbyBorderRemoved: boolean = false;\n  private tabbyRemoveBorderTries: number = 0;\n\n  constructor() {\n    salla.lang.onLoaded(() => {\n      const installment = salla.config.get('store.settings.installments');\n      if (installment) {\n        this.tamaraIsActive = installment.includes('tamara_installment');\n        this.tabbyIsActive = installment.includes('tabby_installment');\n        this.spotiiIsActive = installment.includes('spotii_pay');\n      }\n      this.renderInstallments();\n    });\n  }\n\n  /**\n   * Current product price\n   */\n  @Prop() price: string;\n  /**\n   * Language code\n   */\n  @Prop() language: string = salla.config.get('user.language_code');\n  /**\n   * Currency code\n   */\n  @Prop() currency: string = salla.config.get('user.currency_code');\n\n  @State() tamaraIsActive: boolean;\n  @State() tabbyIsActive: boolean;\n  @State() spotiiIsActive: boolean;\n\n  render() {\n    return (\n      <Host>\n        {this.tamaraIsActive ?\n          <div class=\"tamara-product-widget\"\n               data-price={this.price}\n               data-currency={this.currency}\n               data-lang={this.language}\n               data-payment-type=\"installment\">\n          </div>\n          : ''}\n\n        {this.tabbyIsActive ?\n          <div id=\"tabbyPromoWrapper\">\n            <div id=\"tabbyPromo\"></div>\n          </div>\n          : ''}\n\n        {this.spotiiIsActive ?\n          <div class=\"spotii-wrapper\">\n            {/*No need for the price, the price already in the page, and also tammara & tabby doesn't have price */}\n            <div class=\"spotii-promo\"></div>\n          </div>\n          : ''}\n      </Host>\n    );\n  }\n\n  renderInstallments() {\n    // Tamara\n    if (this.tamaraIsActive) {\n      var script = document.createElement('script');\n      script.setAttribute('src', 'https://cdn.tamara.co/widget/product-widget.min.js');\n      document.head.appendChild(script);\n      script.onload = () => {\n        window.TamaraProductWidget.init({lang: this.language})\n        setTimeout(() => {\n          window.TamaraProductWidget.render()\n        }, 300)\n      }\n    }\n\n    // tabby\n    if (this.tabbyIsActive) {\n      var script = document.createElement('script');\n      script.setAttribute('src', 'https://checkout.tabby.ai/tabby-promo.js');\n      document.head.appendChild(script);\n      script.onload = () => {\n        const TabbyPromo = window.TabbyPromo;\n        new TabbyPromo({\n          selector: '#tabbyPromo',\n          currency: this.currency,\n          price: this.price,\n          lang: this.language,\n        });\n        document.querySelectorAll('.tabby-promo-snippet__logo').forEach(function (element) {\n          element.setAttribute('aria-label', 'Tabby Logo')\n        });\n      }\n      //this is workaround to remove the default border and add margin\n      this.removeTabbyBorder();\n    }\n\n    // Spotii\n    if (this.spotiiIsActive) {\n      let amount = salla.money((Number(this.price) / 3).toFixed(2));\n      let isRTL = salla.config.get('theme.is_rtl', true);\n      window.spotiiConfig = {\n        targetXPath: ['.spotii-wrapper'],\n        renderToPath: ['.spotii-promo'],\n        numberOfPayment: 3,\n        currency: this.currency,\n        templateLine: \"${textOne} ${number} ${textTwo} \" + amount + \"${logo} ${info}\",\n        //todo:: translate these\n        textOne: isRTL ? \"جزء الدفع على\" : \"Split it into\",\n        textTwo: isRTL ? \"أقساط متساوية بدون تكاليف اضافية بقيمة\" : \"payments of\",\n        textThree: \"مع\",\n        price: this.price,\n        // forcedShow: false,\n        // merchantID: null,\n      }\n\n      var script = document.createElement('script');\n\n      script.setAttribute('src', salla.url.cdn('js/price-widget-ar-salla.js'));\n      document.head.appendChild(script);\n      // script.onload = () => {\n      //   // setTimeout()\n      // }\n    }\n\n  }\n\n  /**\n   * this is workaround to remove the default border and add margin\n   * we will try to remove tabby border 5 times for 7.5 seconds\n   */\n  removeTabbyBorder() {\n    if (this.tabbyBorderRemoved || this.tabbyRemoveBorderTries > 5) {\n      return;\n    }\n    this.tabbyRemoveBorderTries++;\n    setTimeout(() => {\n      let promo: any = document.querySelector('#tabbyPromo>div>div');\n      promo = promo ? promo.shadowRoot.querySelector('div[class^=\"styles__tabby-promo-snippet--\"]') : null;\n      if (promo) {\n        promo.style = 'border: none; margin: 15px 0!important;';\n        this.tabbyBorderRemoved = true;\n      } else {\n        this.removeTabbyBorder();\n      }\n    }, this.tabbyRemoveBorderTries * 500)\n  }\n}\n"]}