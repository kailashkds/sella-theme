{"version":3,"file":"salla-search.js","sourceRoot":"","sources":["../../../src/components/salla-search/salla-search.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Prop, h, State, Element, Listen, Watch } from '@stencil/core';\nimport { HTMLStencilElement } from '@stencil/core/internal';\nimport SearchProductsResponse from \"./search-response\";\nimport Search from \"../../assets/svg/search.svg\";\nimport Helper from '../../Helpers/Helper';\n\n/**\n * @slot product - Replaces products card in the results, has replaceable props `{name}`, `{price}`, `{regular_price}`, `{image}`.\n */\n@Component({ tag: 'salla-search', styleUrl: 'salla-search.scss' })\nexport class SallaSearch {\n  constructor() {\n    this.productSlot = this.host.querySelector('[slot=\"product\"]')?.innerHTML || this.getDefaultProductSlot();\n    salla.event.on('search::open', () => this.open());\n\n    salla.lang.onLoaded(() => {\n      this.translationLoaded = true;\n    });\n\n    salla.event.on('modalClosed', () => this.onModalClose())\n  }\n\n  private readonly productSlot: string;\n  private modal: HTMLSallaModalElement;\n  private container: HTMLElement;\n  private searchInput: HTMLInputElement;\n  private noResults: HTMLElement;\n  private inputValue: string = '';\n\n  @Element() host: HTMLStencilElement;\n  @State() translationLoaded: boolean = false;\n  @State() results: SearchProductsResponse | undefined;\n  @State() loading: boolean = false;\n  @State() typing: boolean = false;\n  @State() debounce: ReturnType<typeof setTimeout> = setTimeout(() => '', 1000);\n  @State() search_term: string;\n\n  /**\n   * Set the component display without modal window. Defaults to `false`\n   */\n  @Prop() inline: boolean = false;\n\n  /**\n   * Adds a border radius to the input. Half of the height.\n   */\n  @Prop() oval: boolean = false;\n\n  /**\n   * Sets the height of the input\n   */\n  @Prop() height: number = 60;\n\n  async open() {\n    if (!this.inline) {\n      await this.modal.open().then(() => setTimeout(() => this.searchInput.focus(), 300)\n      );\n    }\n  }\n  onModalClose() {\n    this.searchInput.value = '';\n    this.results = undefined;\n    this.afterSearching();\n    this.container.classList.remove('s-search-no-results')\n  }\n\n  @Listen('keydown')\n  handleKeyDown(ev: KeyboardEvent) {\n    if (ev.key === 'Enter' && this.search_term?.length) {\n      window.location.href = salla.url.get('search?q=' + encodeURI(this.search_term))\n    }\n  }\n\n  private getDefaultProductSlot() {\n    return '<div class=\"s-search-product-image-container\">' +\n      '  <img class=\"s-search-product-image\" src=\"{image}\" alt=\"{name}\"/>' +\n      '</div>' +\n      '<div class=\"s-search-product-details\">' +\n      '  <div class=\"s-search-product-title\">{name}</div> <div class=\"s-search-product-price\">{price} <span class=\"s-search-product-regular-price\">{regular_price}</span></div>' +\n      '</div>';\n  }\n\n  private debounceSearch(event) {\n    this.typing = true;\n    clearTimeout(this.debounce)\n    this.debounce = setTimeout(() => {\n      this.typing = false\n      this.search_term = event.target.value\n    }, 700)\n  }\n\n  @Watch('search_term')\n  handleSearch(val: string) {\n    this.inputValue = val;\n    if (val.length > 2) {\n      this.search(val);\n    }\n    else {\n      this.results = undefined;\n      this.afterSearching();\n    }\n  }\n\n  search(val) {\n\n    this.noResults.style.display = 'none';\n    //run loading spinner or stop it\n    this.loading = true;\n    salla.product.search(val)\n      .then(response => this.results = response)\n      .catch(err => err !== 'Query is same as previous one!' ? this.results = undefined : null)\n      .finally(() => this.afterSearching(/*isEmpty*/ false));\n  }\n\n  private afterSearching(isEmpty = true) {\n    this.noResults.style.display = isEmpty || this.results?.data.length > 0 ? 'none' : 'block';\n    Helper.toggleElementClassIf(this.container, 's-search-container-open', 's-search-no-results', () => this.results?.data.length)\n    this.loading = false\n    salla.product.api.previousQuery = ''; //avoid having error 'Query is same as previous one!' after reopen modal;\n    this.inputValue.length < 3 ? this.container.classList.remove('s-search-no-results') : '';\n  }\n\n  render() {\n    const searchContent =\n      <div class={{ 's-search-container': true, 's-search-inline': this.inline }} ref={container => this.container = container}>\n        <input type=\"search\"\n          enterkeyhint=\"search\"\n          autocomplete=\"off\"\n          class=\"s-search-input\"\n          placeholder={salla.lang.get('blocks.header.search_placeholder')}\n          onInput={e => this.debounceSearch(e)}\n          onKeyDown={e => this.handleKeyDown(e)}\n          ref={input => this.searchInput = input as HTMLInputElement}\n          style={{ height: this.height + 'px', borderRadius: this.oval ? this.height / 2 + 'px' : '' }} />\n        <span class=\"s-search-icon-wrap\"><span class=\"s-search-icon\" innerHTML={this.loading ? '<i class=\"s-search-spinner-loader\"></i>' : Search}></span></span>\n        <div class=\"s-search-results\">\n          {this.results?.data.map(item =>\n            <a href={item.url} class={{ \"s-search-product\": true, 's-search-product-not-available': !item.is_available }} innerHTML={this.productSlot\n              .replace(/\\{name\\}/g, item.name)\n              .replace(/\\{price\\}/g, salla.money(item.price))\n              .replace(/\\{regular_price\\}/g, item.has_special_price ? salla.money(item.regular_price) : '')\n              .replace(/\\{image\\}/g, item.thumbnail)}/>\n          )}\n          <p ref={el => this.noResults = el} class=\"s-search-no-results-placeholder\">{salla.lang.get('common.elements.no_options')}</p>\n        </div>\n      </div>\n\n    return (\n      this.inline ?\n        <div class=\"s-search-modal\">{searchContent}</div>\n        :\n        <salla-modal position=\"top\" class=\"s-search-modal\" ref={modal => this.modal = modal}>\n          {searchContent}\n        </salla-modal>\n    );\n  }\n\n  /**\n   * Run it one time after load\n   */\n  componentDidLoad() {\n    this.afterSearching();\n  }\n}\n"]}