{"version":3,"file":"salla-rating-stars.js","sourceRoot":"","sources":["../../../src/components/salla-rating-stars/salla-rating-stars.tsx"],"names":[],"mappings":"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","sourcesContent":["import {Component, Host, h, Prop, Element} from '@stencil/core';\nimport Star2 from \"../../assets/svg/star2.svg\";\nimport Helper from '../../Helpers/Helper';\n\n@Component({\n  tag: 'salla-rating-stars',\n  styleUrl: 'salla-rating-stars.scss'\n})\nexport class SallaRatingStars {\n  constructor() {\n    salla.lang.onLoaded(() => {\n      this.reviewsElement && (this.reviewsElement.innerText = `(${salla.helpers.number(salla.lang.choice('pages.rating.reviews', this.reviews))})`);\n    });\n  }\n\n  /**\n   * Sets input name.\n   */\n  @Prop() name: string = 'rating';\n\n  /**\n   * Sets the height and width of the component. Defaults to medium.\n   */\n  @Prop() size: \"large\" | \"medium\" | \"small\" | \"mini\" = 'medium';\n\n  /**\n   * The rating value.\n   */\n  @Prop() value: number;\n\n  /**\n   * Number of reviews to display.\n   */\n  @Prop() reviews: number = 0;\n\n\n  @Element() host: HTMLElement;\n  private startsElem: HTMLElement;\n  private reviewsElement: HTMLElement;\n\n  protected initiateRating() {\n    this.host.addEventListener('click', () => {\n      if (!this.startsElem) return\n\n      // Get the selected star - activeElement is not supported in safari\n      let activeStars = this.startsElem.querySelectorAll('.s-rating-stars-hovered');\n      let selected = activeStars[activeStars.length - 1];\n      if (!selected) return;\n\n      let selectedIndex = selected.getAttribute('data-star');\n      ((this.startsElem as Element).querySelector('.rating_hidden_input') as HTMLInputElement).value = selectedIndex;\n\n      // Loop through each star, and add or remove the `.selected` class to toggle highlighting\n      (this.startsElem as Element).querySelectorAll('.s-rating-stars-btn-star')\n        .forEach((star, index) => Helper.toggleElementClassIf(star, 's-rating-stars-selected', 's-rating-stars-unselected', () => index < parseInt(selectedIndex)));\n\n      // update aria-pressed attr status\n      (this.startsElem as Element).querySelectorAll('[aria-pressed]').forEach(star => star.removeAttribute('aria-pressed'));\n      selected.setAttribute('aria-pressed', 'true');\n    });\n  }\n\n  private highlightSelectedStars() {\n    let hoveredClass = 's-rating-stars-hovered',\n      stars = this.startsElem?.querySelectorAll('.s-rating-stars-btn-star');\n    stars?.forEach((star, index) => {\n      star.addEventListener('mouseover', () => {\n        for (let i = 0; i <= index; i++) {\n          stars[i].classList.add(hoveredClass)\n        }\n      })\n      star.addEventListener('mouseout', () => star.classList.remove(hoveredClass))\n    })\n    this.startsElem?.addEventListener('mouseout', () => stars.forEach(star => star.classList.remove(hoveredClass)));\n  }\n\n  private createStars(n) {\n    let stars = [];\n    for (let i = 0; i < 5; i++) {\n      stars.push(<span class={{\n        's-rating-stars-btn-star': true,\n        ['s-rating-stars-' + this.size]: true,\n        's-rating-stars-selected': i < n\n      }} innerHTML={Star2}/>);\n    }\n    if (this.reviews > 0) {\n      stars.push(<span class=\"s-rating-stars-reviews\" ref={el => this.reviewsElement = el}>\n        ({salla.helpers.number(salla.lang.choice('pages.rating.reviews', this.reviews))})\n      </span>)\n    }\n    return stars;\n  }\n\n  render() {\n    //TODO:: find a better fix, this is a patch for issue that duplicates the stars twice @see the screenshot inside this folder\n    return this.host.closest('.swiper-slide')?.classList.contains('swiper-slide-duplicate')\n      ? ''\n      : (\n        <Host>\n          {this.value || this.value == 0 ?\n            <div class=\"s-rating-stars-wrapper\"> {this.createStars(this.value)} </div>\n            :\n            <div class=\"s-rating-stars-element\" ref={(el) => this.startsElem = el as HTMLElement}>\n              <input type=\"hidden\" class=\"rating_hidden_input\" name={this.name} value=\"\"/>\n              {[1, 2, 3, 4, 5].map(star =>\n                <button class={`s-rating-stars-btn-star s-rating-stars-` + this.size} data-star={star}>\n                  <span innerHTML={Star2}/>\n                </button>\n              )}\n            </div>\n          }\n        </Host>\n      );\n  }\n\n  componentDidLoad() {\n    this.initiateRating();\n    this.highlightSelectedStars();\n  }\n}\n"]}