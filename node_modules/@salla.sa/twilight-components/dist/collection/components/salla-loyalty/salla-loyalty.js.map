{"version":3,"file":"salla-loyalty.js","sourceRoot":"","sources":["../../../src/components/salla-loyalty/salla-loyalty.tsx"],"names":[],"mappings":"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","sourcesContent":["import {Item, LoyaltyProgram, Prize} from './loyalty-schema';\nimport {Component, h, Method, Prop, State} from '@stencil/core';\nimport Star2 from '../../assets/svg/star2.svg';\nimport Star3 from '../../assets/svg/star3.svg';\nimport CancelIcon from '../../assets/svg/cancel.svg';\nimport GiftImg from '../../assets/svg/flat.svg';\n\n/**\n * @slot widget - When used, will activate the component and needs to emit `loyalty::open` event to open the modal. If not provided the default value will be used.\n * @slot points-applied-widget -  Widget to show information about the already exchanged points. It should have it's own resetting action and call the `resetExchange` method. If not provided, it will use the default value.\n */\n@Component({\n  tag: 'salla-loyalty',\n  styleUrl: 'salla-loyalty.scss',\n})\nexport class SallaLoyalty {\n\n  constructor() {\n    salla.event.on('loyalty::open', () => this.open());\n\n    salla.auth.event.onLoggedIn(() => {\n      this.is_loggedin = true\n    })\n\n    salla.onReady(() => {\n      this.is_loggedin = salla.config.isUser()\n    })\n\n    salla.lang.onLoaded(() => {\n      this.guestMessage = salla.lang.get('pages.loyalty_program.guest_message');\n      this.translationLoaded = true;\n    })\n\n    salla.cart.event.onUpdated(cart => {\n      this.prizePoints = cart.loyalty.prize?.points;\n      this.prizeTitle = cart.loyalty.prize?.title;\n      this.customerPoints = cart.loyalty.customer_points || this.customerPoints;\n    })\n  }\n\n  private modal: HTMLSallaModalElement;\n  private confirmationModal: HTMLSallaModalElement;\n\n  @State() loyaltyProgram: LoyaltyProgram = undefined;\n  @State() buttonLoading: boolean;\n  @State() selectedItem: Item | undefined = undefined;\n  @State() askConfirmation: boolean;\n  @State() is_loggedin: boolean;\n  @State() hasError: boolean;\n\n  @State() errorMessage: string;\n\n  //todo:: drop it\n  @State() translationLoaded: boolean;\n\n  /**\n   * The exchanged prize point\n   */\n  @Prop({mutable: true, reflect: true}) prizePoints: string | number;\n\n  /**\n   * Available customer points with which they can exchange.\n   */\n  @Prop({mutable: true, reflect: true}) customerPoints: number;\n\n  /**\n   * The prize title\n   */\n  @Prop({mutable: true, reflect: true}) prizeTitle: string;\n\n  /**\n   * Does the merchant allow to login using email\n   */\n  @Prop() allowEmail: boolean = true;\n\n  /**\n   * Does the merchant/current location for visitor allow to login using mobile, By default outside KSA is `false`\n   */\n  @Prop() allowMobile: boolean = true;\n\n  /**\n   * Does the merchant require registration with email & mobile\n   */\n  @Prop() requireEmail: boolean = false;\n\n  //todo:: change it to state\n  /**\n   * Message to show for guest users.\n   */\n  @Prop({mutable: true}) guestMessage: string\n\n\n  private setSelectedPrizeItem(item) {\n    if (!this.selectedItem || this.selectedItem?.id != item.id) {\n      this.selectedItem = item;\n    } else {\n      this.selectedItem = undefined\n    }\n  }\n\n  private handleLongText(text: string) {\n    if (text.length > 150) {\n      return text.substring(0, 150) + '...';\n    }\n\n    return text;\n  }\n\n  private prizeItem(item: Item) {\n    let klass = {\n      's-loyalty-prize-item-selected': !!this.selectedItem && this.selectedItem?.id == item.id,\n      \"s-loyalty-prize-item\": true\n    }\n    return <div onClick={() => this.setSelectedPrizeItem(item)} class={klass}>\n      <img class=\"s-loyalty-prize-item-image\" src={item.image} alt={item.name}/>\n      <div class=\"s-loyalty-prize-item-title\">{item.name}</div>\n      <div class=\"s-loyalty-prize-item-subtitle\">{this.handleLongText(item.description)}</div>\n      <div class=\"s-loyalty-prize-item-points\">\n        {item.cost_points} {salla.lang.get('pages.loyalty_program.point')}\n        <div class=\"s-loyalty-prize-item-check\">\n          <div></div>\n        </div>\n      </div>\n    </div>\n  }\n\n  private getConfirmationModal() {\n    return [\n      <salla-placeholder alignment=\"center\" icon={Star3} class=\"s-loyalty-confirmation-modal-content\">\n        <div slot=\"title\" class=\"s-loyalty-confirmation-title\">\n          {salla.lang.get('pages.loyalty_program.exchange_points')}\n        </div>\n        <div slot=\"description\">\n          {salla.lang.get('pages.loyalty_program.are_you_sure_to_exchange')} ( <strong>{this.selectedItem?.cost_points}</strong> {salla.lang.get('pages.loyalty_program.point')} ) {salla.lang.get('pages.loyalty_program.for')} ( <strong>{this.selectedItem?.name}</strong> )\n        </div>\n      </salla-placeholder>,\n      <div class=\"s-loyalty-confirmation-actions\">\n        <salla-button fill='outline' width=\"wide\"\n                      onClick={() => this.cancelProcess()}>{salla.lang.get('pages.loyalty_program.cancellation')}</salla-button>\n        <salla-button loading={this.buttonLoading} width=\"wide\"\n                      onClick={() => this.exchangeLoyaltyPoint()}>{salla.lang.get('pages.loyalty_program.confirm')}</salla-button>\n      </div>\n    ]\n  }\n\n  private getAfterExchangeUI() {\n    return <slot name='points-applied-widget'>\n      <salla-list-tile class=\"s-loyalty-after-exchange\">\n        <div slot=\"title\" class=\"s-loyalty-after-exchange-title\">\n          {this.prizeTitle} &nbsp; - &nbsp; {this.prizePoints} {salla.lang.get('pages.loyalty_program.point')}\n        </div>\n        <div slot='action' class=\"s-loyalty-after-exchange-action\">\n          <salla-button class=\"s-loyalty-after-exchange-reset\" shape=\"icon\" fill='outline' color=\"danger\" size=\"small\"\n                        onClick={() => this.resetExchange()}>\n            <span innerHTML={CancelIcon}/>\n          </salla-button>\n        </div>\n      </salla-list-tile>\n    </slot>\n  }\n\n  /**\n   * Show loyalty modal\n   */\n  @Method()\n  async open() {\n    if (!this.is_loggedin) return salla.event.dispatch('login::open');\n    this.modal?.open()\n    return await salla.loyalty.getProgram()\n      .then(response => {\n        this.loyaltyProgram = response.data as LoyaltyProgram\n      })\n      .catch(e => {\n        this.hasError = true;\n        this.errorMessage = e.response?.data?.error?.message || e.response?.data;\n      })\n      .finally(() => this.modal?.stopLoading())\n\n  }\n\n  /**\n   *\n   * Hide loyalty modal\n   */\n  @Method()\n  async close() {\n    return this.modal.close();\n  }\n\n  /**\n   *\n   * Cancel Exchanged prizes\n   */\n  @Method()\n  async resetExchange() {\n    return await salla.loyalty.reset();\n  }\n\n  /**\n   * Open Confirmation modal\n   */\n  private async openConfirmation() {\n    return await this.modal.close()\n      .then(() => this.confirmationModal?.open())\n      .catch(e => console.log(e))\n  }\n\n  /**\n   * Cancel process\n   */\n  private async cancelProcess() {\n    return await this.confirmationModal.close()\n      .then(() => this.selectedItem = null)\n      .catch(e => console.log(e))\n  }\n\n  /**\n   * Exchange loyalty points with the selected prize item\n   * @param {number} loyalty_prize_id\n   *\n   */\n  @Method()\n  async exchangeLoyaltyPoint() {\n    this.buttonLoading = true;\n    return await salla.loyalty.exchange(this.selectedItem?.id)\n      .then(() => this.selectedItem.key == \"FREE_PRODUCT\" && salla.url.is_page('cart') && window.location.reload())\n      .finally(() => {\n          this.buttonLoading = false;\n          this.cancelProcess()\n        }\n      )\n  }\n\n  render() {\n\n    // A. when the exchange is done, and we have the final prize points to show it in cart page\n    if (this.prizePoints) {\n      return this.getAfterExchangeUI();\n    }\n\n    //todo:: change all translations to states\n    return [\n      <slot name='widget'>\n        {/* B. he wants to use the default widget by pass the customer points . */}\n        {\n          this.customerPoints ?\n            <salla-list-tile class='s-loyalty-widget'>\n              <div slot=\"icon\" class=\"s-loyalty-widget-icon\" innerHTML={Star2}/>\n              <div slot=\"subtitle\">\n                {this.customerPoints ? salla.lang.get('pages.loyalty_program.cart_total_point_summary', {\"balance\": this.customerPoints}) : this.guestMessage}\n                <salla-button shape=\"link\" color=\"primary\" onClick={() => salla.event.dispatch(\"loyalty::open\")}>\n                  {this.customerPoints ? salla.lang.get('pages.loyalty_program.cart_point_exchange_now') : salla.lang.get('blocks.header.login')}\n                </salla-button>\n              </div>\n            </salla-list-tile> :\n            ''\n        }\n      </slot>,\n      <salla-modal noPadding width=\"sm\"\n                   ref={modal => this.confirmationModal = modal}>\n        {this.getConfirmationModal()}\n      </salla-modal>,\n      <salla-modal isLoading={true} has-skeleton={true} width=\"md\" ref={modal => this.modal = modal}>\n        <div slot=\"loading\">\n          <div class=\"s-loyalty-skeleton\">\n            <salla-list-tile class=\"s-loyalty-header\">\n              <div slot=\"icon\" class=\"s-loyalty-header-icon\">\n                <salla-skeleton type=\"circle\" height='6rem' width='6rem'/>\n              </div>\n\n              <div slot=\"title\" class=\"s-loyalty-header-title mb-5\">\n                <salla-skeleton height='15px' width='50%'/>\n              </div>\n              <div slot=\"subtitle\" class=\"s-loyalty-header-subtitle\">\n                <salla-skeleton height='10px'/>\n                <salla-skeleton height='10px' width='75%'/>\n              </div>\n\n            </salla-list-tile>\n            <div class=\"s-loyalty-skeleton-cards\">\n              {[...Array(3)].map(() =>\n                <div class=\"s-loyalty-prize-item swiper-slide\">\n                  <salla-skeleton height='9rem'/>\n                  <div class=\"s-loyalty-prize-item-title\">\n                    <salla-skeleton height='15px' width='75%'/>\n                  </div>\n                  <div class=\"s-loyalty-prize-item-subtitle\">\n                    <salla-skeleton height='10px' width='50%'/>\n                    <salla-skeleton height='10px' width='25%'/>\n                  </div>\n                  <div class=\"s-loyalty-prize-item-points\">\n                    <salla-skeleton height='15px' width='100px'/>\n                    <div class=\"s-loyalty-prize-item-check\">\n                      <salla-skeleton height='1rem' width='1rem' type='circle'/>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n        {\n          !this.hasError && !!this.loyaltyProgram ?\n            [\n              <salla-list-tile id='s-loyalty-header' class=\"s-loyalty-header\">\n                <div slot=\"icon\" class=\"s-loyalty-header-icon\" innerHTML={GiftImg}/>\n\n                <div slot=\"title\" class=\"s-loyalty-header-title\">\n                  {this.loyaltyProgram.prize_promotion_title}\n                </div>\n\n                <div slot=\"subtitle\" class=\"s-loyalty-header-subtitle\">\n                  {this.loyaltyProgram.prize_promotion_description}\n                </div>\n\n              </salla-list-tile>,\n              <salla-tabs>\n                {this.loyaltyProgram.prizes.map((prize: Prize) =>\n                  <salla-tab-header slot=\"header\" name={prize.title}>\n                    <span>{prize.title}</span>\n                  </salla-tab-header>\n                )}\n                {this.loyaltyProgram.prizes.map((prize: Prize, index) =>\n                  <salla-tab-content slot=\"content\" name={prize.title}>\n                    <salla-slider\n                      class=\"s-loyalty-slider\"\n                      loop={false}\n                      controls-outer={true}\n                      id={'loyalty-popup-slider-' + index}\n                      type=\"carousel\">\n                      <div slot='items'>\n                        {prize.items.map((item: Item) =>\n                          this.prizeItem(item)\n                        )}\n                      </div>\n                    </salla-slider>\n                  </salla-tab-content>\n                )}\n              </salla-tabs>,\n              <salla-button disabled={!this.selectedItem} width=\"wide\"\n                            class=\"s-loyalty-program-redeem-btn\"\n                            onClick={() => this.openConfirmation()}>{salla.lang.get('pages.loyalty_program.exchange_points')}</salla-button>,\n\n            ]\n            : <salla-placeholder class=\"s-loyalty-placeholder\" alignment=\"center\">\n              {!!this.errorMessage ? <span slot=\"description\">{this.errorMessage}</span> : ''}\n            </salla-placeholder>\n        }\n      </salla-modal>,\n    ];\n  }\n}\n"]}