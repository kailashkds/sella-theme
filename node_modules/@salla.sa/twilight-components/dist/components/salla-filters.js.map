{"file":"salla-filters.js","mappings":"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","names":["SallaFilters"],"sources":["./src/components/salla-filters/salla-filters.scss?tag=salla-filters","./src/components/salla-filters/salla-filters.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n.s-rating-stars-small {\n  line-height: 12px;\n}\n.s-filters-radio{\n  background-image: none !important;\n}","import { Component, Element, h, Event, EventEmitter, Host, Method, Prop, State } from '@stencil/core';\nimport { Filter, FilterOptionInputType, FilterOptionTypes } from \"./interfaces\";\n\n//todo::\n\n\n@Component({\n  tag: 'salla-filters',\n  styleUrl: 'salla-filters.scss',\n})\nexport class SallaFilters {\n\n  constructor() {\n    salla.event.on('filters::hidden', () => this.host.style.display = 'none');\n\n    salla.lang.onLoaded(() => {\n      this.apply = salla.lang.get('pages.checkout.apply');\n      this.reset = salla.lang.get('pages.categories.filters_reset');\n    });\n\n    salla.event.on('filters::fetched', ({ filters }) => {\n      this.host.style.display = '';\n      let freshFilterData = {};\n      this.filters = filters\n        .map((filter: Filter) => {\n          filter.label = {\n            category_id: salla.lang.get('common.titles.categories'),\n            brand_id: salla.lang.get('common.titles.brands'),\n            rating: salla.lang.get('pages.categories.filter_rating'),\n            price_range: salla.lang.get('pages.categories.filter_price'),\n          }[filter.key] || filter.label;\n          filter.inputType = FilterOptionInputType.CHECKBOX;\n          if (filter.key == 'rating') {\n            filter.inputType = FilterOptionInputType.RADIO;\n            //@ts-ignore\n            let { max, min } = filter.values;\n            //@ts-ignore\n            filter.values = [5, 4, 3, 2, 1].filter(stars => stars >= min || stars <= max)\n          }\n\n          //when getting new filters, maybe less than we had, so let's get from the old one, only what is existed now.\n          if (this.filtersData[filter.key]) {\n            freshFilterData[filter.key] = this.filtersData[filter.key];\n          }\n\n          return filter;\n        });\n      this.filtersData = freshFilterData;\n    });\n  }\n\n  connectedCallback() {\n    try {\n      let filters = (new URLSearchParams(window.location.search)).get('filters')\n      this.filtersData = filters ? JSON.parse(decodeURIComponent(filters)) : {};\n    } catch (e) {\n      salla.logger.warn('failed to get filters from url', e.message);\n    }\n  }\n\n  @Element() host: HTMLElement;\n  @Prop({ reflect: true, mutable: true }) filters?: Filter[];\n  private isReady = false;//to avoid triggering the changed event\n  @State() isSidebarOpen: boolean;\n  @State() filtersData: object = {}\n  @State() apply: string;\n  @State() reset: string;\n  @Event() changed: EventEmitter;\n\n  //TODO:: move all @methods into one section\n  @Method()\n  async getFilters() {\n    return this.filtersData;\n  }\n\n  @Method()\n  async applyFilters() {\n    if (!this.isReady) {\n      return;\n    }\n    let hasFilters = Object.keys(this.filtersData).length > 0;\n    setTimeout(() => {\n      if (hasFilters) {\n        window.history.pushState({}, '', salla.url.addParamToUrl('filters', encodeURIComponent(JSON.stringify(this.filtersData))));\n      } else {\n        let url = new URL(window.location.href);\n        url.searchParams?.delete('filters');\n        window.history.pushState({}, '', url.toString());\n      }\n      salla.event.emit('salla-filters::changed', this.filtersData);\n      this.changed.emit(this.filtersData);\n    }, 300);\n  }\n\n  @Method()\n  async resetFilters() {\n    this.filtersData = {};\n    this.host.childNodes.forEach((widget: HTMLSallaFiltersWidgetElement) => widget.reset && widget.reset())\n    salla.event.emit('salla-filters::reset');\n    return this.applyFilters();\n  }\n\n  /**\n   * @param {{target:HTMLInputElement}} event\n   * @param option\n   * @param value\n   * @private\n   */\n  private handleOptionChange(event, option: Filter, value) {\n    if (option.type === FilterOptionTypes.RANGE) {\n      this.filtersData[option.key] = value;\n      return;\n    }\n    let isChecked = event.target.checked;\n    if (event.target.type == FilterOptionInputType.RADIO) {\n      isChecked && (this.filtersData[option.key] = value);\n      isChecked || (delete this.filtersData[option.key]);\n      return;\n    }\n\n    //it's checkbox\n    this.filtersData[option.key] = this.filtersData[option.key] || [];\n    if (isChecked) {\n      this.filtersData[option.key].push(value);\n      return;\n    }\n    this.filtersData[option.key] = this.filtersData[option.key].filter(val => val != value);\n  }\n\n  render() {\n    return <Host>\n      {this.filters?.map(option => <salla-filters-widget\n        option={option}\n        filtersData={this.filtersData}\n        onChanged={({ detail: { event, option, value } }) => this.handleOptionChange(event, option, value)} />)}\n\n      {this.filters?.length && <div class=\"s-filters-footer\">\n        <salla-button color='primary' onClick={() => this.applyFilters()}>{this.apply}</salla-button>\n        <salla-button color='gray' fill='outline' onClick={() => this.resetFilters()}>{this.reset}</salla-button>\n      </div>}\n    </Host>;\n  }\n\n  componentDidLoad() {\n    this.isReady = true;\n  }\n}\n\n"],"version":3}