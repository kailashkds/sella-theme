{"file":"salla-search.js","mappings":"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","names":["SallaSearch"],"sources":["./src/components/salla-search/salla-search.scss?tag=salla-search","./src/components/salla-search/salla-search.tsx"],"sourcesContent":["/*\n* Salla Search Component: Site search modal.\n* You can use these classes to target the elements in the component.\n*/\n\n.s-search {\n  &-inline{\n    \n  }\n  &-container {\n    &-open {\n\n    }\n  }\n  &-input {\n\n  }\n  &-icon {\n\n  }\n  &-spinner {\n\n  }\n  &-spinner-loader {\n\n  }\n  &-results {\n\n  }\n  &-no-results{\n\n  }\n  &-container-open{\n    \n  }\n  &-product {\n    &-image-container {\n\n    }\n    &-image {\n      \n    }\n    &-details {\n\n    }\n    &-title {\n\n    }\n    &-price {\n\n    }\n  }\n}\n","import { Component, Prop, h, State, Element, Listen, Watch } from '@stencil/core';\nimport { HTMLStencilElement } from '@stencil/core/internal';\nimport SearchProductsResponse from \"./search-response\";\nimport Search from \"../../assets/svg/search.svg\";\nimport Helper from '../../Helpers/Helper';\n\n/**\n * @slot product - Replaces products card in the results, has replaceable props `{name}`, `{price}`, `{regular_price}`, `{image}`.\n */\n@Component({ tag: 'salla-search', styleUrl: 'salla-search.scss' })\nexport class SallaSearch {\n  constructor() {\n    this.productSlot = this.host.querySelector('[slot=\"product\"]')?.innerHTML || this.getDefaultProductSlot();\n    salla.event.on('search::open', () => this.open());\n\n    salla.lang.onLoaded(() => {\n      this.translationLoaded = true;\n    });\n\n    salla.event.on('modalClosed', () => this.onModalClose())\n  }\n\n  private readonly productSlot: string;\n  private modal: HTMLSallaModalElement;\n  private container: HTMLElement;\n  private searchInput: HTMLInputElement;\n  private noResults: HTMLElement;\n  private inputValue: string = '';\n\n  @Element() host: HTMLStencilElement;\n  @State() translationLoaded: boolean = false;\n  @State() results: SearchProductsResponse | undefined;\n  @State() loading: boolean = false;\n  @State() typing: boolean = false;\n  @State() debounce: ReturnType<typeof setTimeout> = setTimeout(() => '', 1000);\n  @State() search_term: string;\n\n  /**\n   * Set the component display without modal window. Defaults to `false`\n   */\n  @Prop() inline: boolean = false;\n\n  /**\n   * Adds a border radius to the input. Half of the height.\n   */\n  @Prop() oval: boolean = false;\n\n  /**\n   * Sets the height of the input\n   */\n  @Prop() height: number = 60;\n\n  async open() {\n    if (!this.inline) {\n      await this.modal.open().then(() => setTimeout(() => this.searchInput.focus(), 300)\n      );\n    }\n  }\n  onModalClose() {\n    this.searchInput.value = '';\n    this.results = undefined;\n    this.afterSearching();\n    this.container.classList.remove('s-search-no-results')\n  }\n\n  @Listen('keydown')\n  handleKeyDown(ev: KeyboardEvent) {\n    if (ev.key === 'Enter' && this.search_term?.length) {\n      window.location.href = salla.url.get('search?q=' + encodeURI(this.search_term))\n    }\n  }\n\n  private getDefaultProductSlot() {\n    return '<div class=\"s-search-product-image-container\">' +\n      '  <img class=\"s-search-product-image\" src=\"{image}\" alt=\"{name}\"/>' +\n      '</div>' +\n      '<div class=\"s-search-product-details\">' +\n      '  <div class=\"s-search-product-title\">{name}</div> <div class=\"s-search-product-price\">{price} <span class=\"s-search-product-regular-price\">{regular_price}</span></div>' +\n      '</div>';\n  }\n\n  private debounceSearch(event) {\n    this.typing = true;\n    clearTimeout(this.debounce)\n    this.debounce = setTimeout(() => {\n      this.typing = false\n      this.search_term = event.target.value\n    }, 700)\n  }\n\n  @Watch('search_term')\n  handleSearch(val: string) {\n    this.inputValue = val;\n    if (val.length > 2) {\n      this.search(val);\n    }\n    else {\n      this.results = undefined;\n      this.afterSearching();\n    }\n  }\n\n  search(val) {\n\n    this.noResults.style.display = 'none';\n    //run loading spinner or stop it\n    this.loading = true;\n    salla.product.fetch({source:\"search\", source_value:val})\n      .then(response => this.results = response)\n      .catch(err => err !== 'Query is same as previous one!' ? this.results = undefined : null)\n      .finally(() => this.afterSearching(/*isEmpty*/ false));\n  }\n\n  private afterSearching(isEmpty = true) {\n    this.noResults.style.display = isEmpty || this.results?.data.length > 0 ? 'none' : 'block';\n    Helper.toggleElementClassIf(this.container, 's-search-container-open', 's-search-no-results', () => this.results?.data.length)\n    this.loading = false\n    salla.product.api.previousQuery = ''; //avoid having error 'Query is same as previous one!' after reopen modal;\n    this.inputValue.length < 3 ? this.container.classList.remove('s-search-no-results') : '';\n  }\n\n  render() {\n    const searchContent =\n      <div class={{ 's-search-container': true, 's-search-inline': this.inline }} ref={container => this.container = container}>\n        <input type=\"search\"\n          enterkeyhint=\"search\"\n          autocomplete=\"off\"\n          class=\"s-search-input\"\n          placeholder={salla.lang.get('blocks.header.search_placeholder')}\n          onInput={e => this.debounceSearch(e)}\n          onKeyDown={e => this.handleKeyDown(e)}\n          ref={input => this.searchInput = input as HTMLInputElement}\n          style={{ height: this.height + 'px', borderRadius: this.oval ? this.height / 2 + 'px' : '' }} />\n        <span class=\"s-search-icon-wrap\"><span class=\"s-search-icon\" innerHTML={this.loading ? '<i class=\"s-search-spinner-loader\"/>' : Search}/></span>\n        <div class=\"s-search-results\">\n          {this.results?.data.map((product) =>\n            <a href={product.url} class={{ \"s-search-product\": true, 's-search-product-not-available': !product.is_available }} innerHTML={this.productSlot\n              .replace(/\\{name\\}/g, product.name)\n              .replace(/\\{price\\}/g, salla.money(product.price))\n              .replace(/\\{regular_price\\}/g, product.is_on_sale ? salla.money(product.regular_price) : '')\n              .replace(/\\{image\\}/g, product.image.url)}/>\n          )}\n          <p ref={el => this.noResults = el} class=\"s-search-no-results-placeholder\">{salla.lang.get('common.elements.no_options')}</p>\n        </div>\n      </div>\n\n    return (\n      this.inline ?\n        <div class=\"s-search-modal\">{searchContent}</div>\n        :\n        <salla-modal position=\"top\" class=\"s-search-modal\" ref={modal => this.modal = modal}>\n          {searchContent}\n        </salla-modal>\n    );\n  }\n\n  /**\n   * Run it one time after load\n   */\n  componentDidLoad() {\n    this.afterSearching();\n  }\n}\n"],"version":3}