{"version":3,"names":["sallaProductsListCss","SallaProductsList","class_1","prototype","connectedCallback","_this","this","salla","onReady","hasCustomComponent","customElements","get","sourceValueIsValid","getSourceValue","isSourceWithoutValue","hasInfiniteScroll","includes","getSource","searchParams","URLSearchParams","window","location","search","sortBy","filters","parsedFilters","JSON","parse","decodeURIComponent","e","logger","warn","message","buildNextPageUrl","createStatusDom","isReady","concat","event","on","setFilters","reload","infiniteScroll","destroy","wrapper","innerHTML","init","isFilterable","config","filtersResults","animateItems","anime","targets","opacity","duration","translateY","delay","_el","i","status","document","createElement","className","lang","btnLoader","querySelector","onLoaded","placeholderText","initBaseNextPageUrl","source","nextPage","url","api","limit","key","value","this_1","Array","isArray","forEach","item","_d","_e","Object","entries","length","_f","k","v","_i","_b","_c","join","sourceValue","loading","isLoading","style","display","getItemHTML","product","customComponentTag","customComponent","toggleAttribute","classList","add","horizontalCards","fetchProducts","fetch","source_value","then","res","data","showPlaceholder","handleResponse","card","append","initiateInfiniteScroll","host","insertAdjacentElement","initiate","path","history","scrollThreshold","response","_a","appendItems","pageIndex","remove","loadNextPage","canRender","render","h","class","ShoppingBag","Host","ref","componentDidLoad","map","emit","cursor","next","option","loadOnScroll"],"sources":["src/components/salla-products-list/salla-products-list.scss?tag=salla-products-list","src/components/salla-products-list/salla-products-list.tsx"],"sourcesContent":["\n","import {Component, Host, h, Prop, State, Element, Method} from '@stencil/core';\nimport anime from 'animejs';\nimport ShoppingBag from '../../assets/svg/shopping-bag.svg';\n\n@Component({\n  tag: 'salla-products-list',\n  styleUrl: 'salla-products-list.scss'\n})\nexport class SallaProductsList {\n  connectedCallback() {\n    salla.onReady(() => {\n      this.hasCustomComponent = !!customElements.get('custom-salla-product-card');\n      this.sourceValueIsValid = !!(this.getSourceValue() || this.isSourceWithoutValue());\n      this.hasInfiniteScroll = !['json', 'selected', 'related', 'landing-page'].includes(this.getSource());\n      try {\n        let searchParams = new URLSearchParams(window.location.search);\n        this.sortBy = this.sortBy || searchParams.get('sort') || searchParams.get('by');\n        let filters = searchParams.get('filters')\n        this.parsedFilters = filters ? JSON.parse(decodeURIComponent(filters)) : {};\n      } catch (e) {\n        salla.logger.warn('failed to get filters from url', e.message);\n      }\n      this.buildNextPageUrl();\n      this.createStatusDom();\n\n      this.isReady = true;\n    });\n\n    if (!this.sourceValueIsValid) {\n      salla.logger.warn(`source-value prop is required for source [${this.getSource()}]`);\n      return;\n    }\n    salla.event.on('salla-filters::changed', filters => this.setFilters(filters))\n\n\n  }\n\n  @Method()\n  async setFilters(filters) {\n    this.parsedFilters = filters;\n    return this.reload();\n  }\n\n\n  @Method()\n  async reload() {\n    salla.infiniteScroll.destroy(this.infiniteScroll);\n    this.buildNextPageUrl();\n    this.wrapper.innerHTML = '';\n    this.init();\n  }\n\n\n  private status: HTMLDivElement;\n  private btnLoader: HTMLAnchorElement;\n  @Element() host: HTMLElement;\n  private wrapper: any;\n  private infiniteScroll: any;\n  /**\n   * The source of the products list\n   * @type {string}\n   * */\n  @Prop({\n    reflect: true,\n    mutable: true\n  }) source: 'categories' | 'latest' | 'related' | 'brands' | 'json' | 'search' | 'tags' | 'selected' | 'offers' | 'landing-page' | 'sales';\n\n  /**\n   * The source value, cloud be different values as following:\n   * - array of ids when `source` in ['categories', 'brands', 'tags', 'selected']\n   * - keyword when `source` = 'search'\n   * - products payload when `source` = 'json'\n   * - product_id when `source` = 'related'\n   *\n   * @type {string}\n   * */\n  @Prop({mutable: true}) sourceValue: any;\n\n  /**\n   * Limit for number of products in the list.\n   */\n  @Prop({mutable: true}) limit: number;\n\n  /**\n   * Sorting the list of products\n   */\n  @Prop({mutable: true}) sortBy?: string | 'ourSuggest' | 'bestSell' | 'topRated' | 'priceFromTopToLow' | 'priceFromLowToTop';\n\n  /**\n   * should listen to filters events `salla-filters::changed` and re-render\n   */\n  @Prop({reflect: true, mutable: true}) filtersResults: boolean;\n\n  /**\n   * Horizontal cards\n   */\n  @Prop({reflect: true}) horizontalCards: boolean\n\n  // State\n  @State() page: number = 1;\n  @State() nextPage: string;\n  @State() hasInfiniteScroll: boolean;\n  @State() hasCustomComponent: boolean;\n  @State() sourceValueIsValid: boolean;\n  @State() placeholderText: string;\n  @State() isReady: boolean;\n  @State() showPlaceholder: boolean;\n  @State() parsedFilters: any;\n\n  private isFilterable() {\n    return salla.config.get('store.settings.product.filters') && this.filtersResults;\n  }\n\n  private isSourceWithoutValue() {\n    return ['offers', 'latest', 'sales'].includes(this.getSource());\n  }\n\n  private animateItems() {\n    anime({\n      targets: 'salla-products-list salla-product-card',\n      opacity: [0, 1],\n      duration: 1200,\n      translateY: [20, 0],\n      delay: function (_el, i) {\n        return i * 100;\n      },\n    })\n  }\n\n  private createStatusDom() {\n    this.status = document.createElement('div');\n    this.status.className = 's-infinite-scroll-wrapper';\n    this.status.innerHTML = `<div class=\"s-infinite-scroll-status\">\n        <p class=\"s-infinite-scroll-last infinite-scroll-last s-hidden\" >${salla.lang.get('common.elements.end_of_content')}</p>\n        <p class=\"s-infinite-scroll-error infinite-scroll-error s-hidden\">${salla.lang.get('common.elements.failed_to_load_more')}</p>\n      </div>\n      <a href=\"#\" class=\"s-infinite-scroll-btn s-button-btn\">\n        <span class=\"s-button-loader s-button-loader-center s-infinite-scroll-btn-loader\" style=\"display: none\"></span>\n      </a>`;\n    this.btnLoader = this.status.querySelector('.s-button-loader');\n    salla.lang.onLoaded(() => {\n      this.status.querySelector('.s-infinite-scroll-last').innerHTML = salla.lang.get('common.elements.end_of_content');\n      this.status.querySelector('.s-infinite-scroll-error').innerHTML = salla.lang.get('common.elements.failed_to_load_more');\n      this.placeholderText = salla.lang.get('pages.categories.no_products');\n    });\n  }\n\n  private initBaseNextPageUrl(source: string) {\n\n    this.nextPage = salla.url.api(`products?source=${source}`);\n\n    if (this.limit) {\n      this.nextPage += `&per_page=${this.limit > 32 ? 32 : this.limit}`;\n    }\n    if (this.sortBy) {\n      this.nextPage += `&sort=${this.sortBy}`;\n    }\n    // if (!this.isFilterable()) {\n    //   return this.nextPage;\n    // }\n    this.nextPage += '&filterable=1';\n    for (const [key, value] of Object.entries(this.parsedFilters || {})) {\n      if ([\"string\", \"number\"].includes(typeof value)) {\n        this.nextPage += `&filters[${key}]=${value}`;\n      } else if (Array.isArray(value)) {\n        (value as any).forEach(item => this.nextPage += `&filters[${key}][]=${item}`)\n      } else if (typeof value === 'object') {\n        for (const [k, v] of Object.entries(value)) {\n          this.nextPage += `&filters[${key}][${k}]=${v}`;\n        }\n      }\n    }\n  }\n\n  private buildNextPageUrl() {\n    let source = this.getSource();\n    if (source === 'json') {\n      return;\n    }\n    this.initBaseNextPageUrl(source);\n    if (this.isSourceWithoutValue()) {\n      return;\n    }\n\n    if (['search', 'related', 'landing-page'].includes(source)) {\n      this.nextPage += `&source_value=${this.getSourceValue()}`;\n      return;\n    }\n\n    try {\n      this.nextPage += `&source_value[]=${this.getSourceValue().join('&source_value[]=')}`;\n    } catch (e) {\n      salla.logger.warn(`source-value prop should be array of ids ex source-value=\"[1,2,3]\" for the source [${source}]`);\n      this.sourceValueIsValid = false;\n    }\n  }\n\n  private getSource() {\n    return {\n      'brands.single': 'brands',\n      'product.index': 'categories',\n      'product.index.latest': 'latest',\n      'product.index.offers': 'offers',\n      'product.index.search': 'search',\n      'landing-page': 'landing-page',\n      'product.index.tag': 'tags',\n      'product.index.sales': 'sales',\n      'components.most_sales_products': 'sales',//temporary, delete it after two days from now\n    }[this.source || salla.config.get('page.slug')] || this.source || 'latest';\n  }\n\n  private getSourceValue() {\n    let source = this.getSource();\n\n    //todo:: enhance this code, it call JSON.parse too many times.\n    if (!['search', 'json', 'offers', 'latest', 'sales'].includes(source)) {\n      if (this.sourceValue && Array.isArray(JSON.parse(this.sourceValue)) && JSON.parse(this.sourceValue).length) {\n        return JSON.parse(this.sourceValue);\n      }\n\n      if (this.sourceValue && typeof JSON.parse(this.sourceValue) == 'number') {\n        return [JSON.parse(this.sourceValue)];\n      }\n      if (!this.sourceValue && ['categories', 'tags', 'brands'].includes(this.getSource())) {\n        return [salla.config.get('page.id')];\n      }\n    }\n\n    if (this.sourceValue) {\n      return this.sourceValue;\n    }\n\n\n    if (source === 'search') {\n      return (new URLSearchParams(window.location.search)).get('q');\n    }\n\n    return salla.config.get('page.id');\n  }\n\n\n  private loading(isLoading = true) {\n    this.btnLoader.style.display = isLoading ? 'inherit' : 'none';\n  }\n\n  private getItemHTML(product) {\n    let customComponentTag: string = this.hasCustomComponent ? 'custom-salla-product-card' : 'salla-product-card';\n    let customComponent: HTMLSallaProductCardElement = document.createElement(customComponentTag) as HTMLSallaProductCardElement;\n    customComponent.product = product;\n    // customComponent.setAttribute('product', JSON.stringify(product));\n    if (this.getSource() == 'landing-page' && !this.hasCustomComponent) {\n      customComponent.toggleAttribute('hide-add-btn', true);\n      customComponent.classList.add('s-product-card-fit-height');\n    }\n    if (this.horizontalCards && !this.hasCustomComponent) {\n      customComponent.toggleAttribute('horizontal', true);\n      customComponent.toggleAttribute('shadow-on-hover', true);\n    }\n    return customComponent;\n  }\n\n  private fetchProducts() {\n    salla.product.fetch({\n      source: this.getSource(),\n      source_value: this.getSourceValue(),\n      limit: this.limit\n    })\n      .then(res => {\n        if (!res.data.length) {\n          this.showPlaceholder = true;\n          this.loading(false);\n          return;\n        }\n        this.handleResponse(res).forEach(card => this.wrapper.append(card));\n      })\n  }\n  \n  private initiateInfiniteScroll() {\n    if (!this.hasInfiniteScroll) {\n      return;\n    }\n\n    this.host.insertAdjacentElement('beforeend', this.status);\n    this.infiniteScroll = salla.infiniteScroll.initiate(this.wrapper, this.wrapper, {\n      path: () => this.nextPage,\n      history: false,\n      nextPage: this.nextPage,\n      scrollThreshold: 100,\n    }, /* infinite via api*/true);\n    this.infiniteScroll.on('request', () => this.loading())\n    this.infiniteScroll.on('load', response => {\n      if (!response.data?.length) {\n        this.showPlaceholder = true;\n        salla.infiniteScroll.destroy(this.infiniteScroll);\n        this.loading(false);\n        return;\n      }else{\n        this.showPlaceholder = false;\n\n      }\n      this.infiniteScroll.appendItems(this.handleResponse(response))\n      if (this.infiniteScroll.pageIndex == 2) {\n        this.animateItems();\n      }\n    })\n    this.infiniteScroll.on('error', () => {\n      this.status.querySelector('.s-infinite-scroll-error').classList.remove('s-hidden')\n      this.loading(false);\n    });\n    salla.onReady(() => salla.infiniteScroll.loadNextPage(this.infiniteScroll))\n  }\n\n  private canRender() {\n    return this.sourceValueIsValid && this.isReady;\n  }\n\n  render() {\n    if (!this.canRender()) {\n      return '';\n    }\n    if (this.showPlaceholder) {\n      return <div class=\"s-products-list-placeholder\">\n        <span innerHTML={ShoppingBag}/>\n        <p>{this.placeholderText}</p>\n      </div>;\n    }\n    return (\n      <Host class=\"s-products-list\">\n        <div class={{\n          \"s-products-list-wrapper\": true,\n          's-products-list-horizontal-cards': this.horizontalCards && !this.filtersResults,\n          's-products-list-vertical-cards': !this.horizontalCards && !this.filtersResults,\n          's-products-list-filters-results': this.filtersResults,\n        }}\n             ref={wrapper => this.wrapper = wrapper}/>\n      </Host>\n    );\n  }\n\n  componentDidLoad() {\n    if (!this.canRender()) {\n      return;\n    }\n\n    // Handle json source\n    if (this.getSource() === 'json') {\n      if (!this.getSourceValue().length) {\n        this.showPlaceholder = true;\n        return;\n      }\n      this.getSourceValue().map(product => this.wrapper.append(this.getItemHTML(product)));\n      return;\n    }\n    // Handle selected source\n    if (this.getSource() === 'selected' || this.getSource() === 'landing-page') {\n      if (this.getSource() === 'selected' && !this.getSourceValue().length) {\n        this.showPlaceholder = true;\n        return;\n      }\n      this.fetchProducts()\n      return;\n    }\n    this.init();\n  }\n\n  private init() {\n    this.initiateInfiniteScroll();\n    this.loading();\n  }\n\n  private handleResponse(response): Array<HTMLElement> {\n    //ðŸ’¡ when source is related, cursor will not be existed\n    if (response.filters && this.isFilterable()) {\n      this.filtersResults = true;\n      salla.event.emit('filters::fetched', {filters: response.filters});\n    } else if (this.isFilterable()) {\n      salla.event.emit('filters::hidden');\n    }\n    this.nextPage = response.cursor ? response.cursor.next : this.nextPage;\n    this.loading(false);\n    if (this.hasInfiniteScroll && !this.nextPage) {\n      this.infiniteScroll.option({scrollThreshold: false, loadOnScroll: false});\n      this.status.querySelector('.s-infinite-scroll-last').classList.remove('s-hidden');\n    }\n    return response.data?.map(product => this.getItemHTML(product)) || [];\n  }\n}\n"],"mappings":"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"}