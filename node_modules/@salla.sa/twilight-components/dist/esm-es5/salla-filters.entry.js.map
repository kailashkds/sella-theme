{"version":3,"names":["sallaFiltersCss","SallaFilters","class_1","hostRef","_this","this","isReady","salla","event","on","host","style","display","lang","onLoaded","apply","get","reset","_c","filters","freshFilterData","map","filter","label","category_id","brand_id","rating","price_range","key","inputType","FilterOptionInputType","CHECKBOX","RADIO","values","max_1","max","min_1","min","stars","filtersData","prototype","connectedCallback","URLSearchParams","window","location","search","JSON","parse","decodeURIComponent","e","logger","warn","message","getFilters","applyFilters","hasFilters","Object","keys","length","setTimeout","history","pushState","url","addParamToUrl","encodeURIComponent","stringify","URL","href","_a","searchParams","delete","toString","emit","changed","resetFilters","childNodes","forEach","widget","handleOptionChange","option","value","type","FilterOptionTypes","RANGE","isChecked","target","checked","push","val","render","h","Host","onChanged","_d","detail","_b","class","color","onClick","fill","componentDidLoad"],"sources":["src/components/salla-filters/salla-filters.scss?tag=salla-filters","src/components/salla-filters/salla-filters.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n.s-rating-stars-small {\n  line-height: 12px;\n}\n.s-filters-radio{\n  background-image: none !important;\n}","import { Component, Element, h, Event, EventEmitter, Host, Method, Prop, State } from '@stencil/core';\nimport { Filter, FilterOptionInputType, FilterOptionTypes } from \"./interfaces\";\n\n//todo::\n\n\n@Component({\n  tag: 'salla-filters',\n  styleUrl: 'salla-filters.scss',\n})\nexport class SallaFilters {\n\n  constructor() {\n    salla.event.on('filters::hidden', () => this.host.style.display = 'none');\n\n    salla.lang.onLoaded(() => {\n      this.apply = salla.lang.get('pages.checkout.apply');\n      this.reset = salla.lang.get('pages.categories.filters_reset');\n    });\n\n    salla.event.on('filters::fetched', ({ filters }) => {\n      this.host.style.display = '';\n      let freshFilterData = {};\n      this.filters = filters\n        .map((filter: Filter) => {\n          filter.label = {\n            category_id: salla.lang.get('common.titles.categories'),\n            brand_id: salla.lang.get('common.titles.brands'),\n            rating: salla.lang.get('pages.categories.filter_rating'),\n            price_range: salla.lang.get('pages.categories.filter_price'),\n          }[filter.key] || filter.label;\n          filter.inputType = FilterOptionInputType.CHECKBOX;\n          if (filter.key == 'rating') {\n            filter.inputType = FilterOptionInputType.RADIO;\n            //@ts-ignore\n            let { max, min } = filter.values;\n            //@ts-ignore\n            filter.values = [5, 4, 3, 2, 1].filter(stars => stars >= min || stars <= max)\n          }\n\n          //when getting new filters, maybe less than we had, so let's get from the old one, only what is existed now.\n          if (this.filtersData[filter.key]) {\n            freshFilterData[filter.key] = this.filtersData[filter.key];\n          }\n\n          return filter;\n        });\n      this.filtersData = freshFilterData;\n    });\n  }\n\n  connectedCallback() {\n    try {\n      let filters = (new URLSearchParams(window.location.search)).get('filters')\n      this.filtersData = filters ? JSON.parse(decodeURIComponent(filters)) : {};\n    } catch (e) {\n      salla.logger.warn('failed to get filters from url', e.message);\n    }\n  }\n\n  @Element() host: HTMLElement;\n  @Prop({ reflect: true, mutable: true }) filters?: Filter[];\n  private isReady = false;//to avoid triggering the changed event\n  @State() isSidebarOpen: boolean;\n  @State() filtersData: object = {}\n  @State() apply: string;\n  @State() reset: string;\n  @Event() changed: EventEmitter;\n\n  //TODO:: move all @methods into one section\n  @Method()\n  async getFilters() {\n    return this.filtersData;\n  }\n\n  @Method()\n  async applyFilters() {\n    if (!this.isReady) {\n      return;\n    }\n    let hasFilters = Object.keys(this.filtersData).length > 0;\n    setTimeout(() => {\n      if (hasFilters) {\n        window.history.pushState({}, '', salla.url.addParamToUrl('filters', encodeURIComponent(JSON.stringify(this.filtersData))));\n      } else {\n        let url = new URL(window.location.href);\n        url.searchParams?.delete('filters');\n        window.history.pushState({}, '', url.toString());\n      }\n      salla.event.emit('salla-filters::changed', this.filtersData);\n      this.changed.emit(this.filtersData);\n    }, 300);\n  }\n\n  @Method()\n  async resetFilters() {\n    this.filtersData = {};\n    this.host.childNodes.forEach((widget: HTMLSallaFiltersWidgetElement) => widget.reset && widget.reset())\n    salla.event.emit('salla-filters::reset');\n    return this.applyFilters();\n  }\n\n  /**\n   * @param {{target:HTMLInputElement}} event\n   * @param option\n   * @param value\n   * @private\n   */\n  private handleOptionChange(event, option: Filter, value) {\n    if (option.type === FilterOptionTypes.RANGE) {\n      this.filtersData[option.key] = value;\n      return;\n    }\n    let isChecked = event.target.checked;\n    if (event.target.type == FilterOptionInputType.RADIO) {\n      isChecked && (this.filtersData[option.key] = value);\n      isChecked || (delete this.filtersData[option.key]);\n      return;\n    }\n\n    //it's checkbox\n    this.filtersData[option.key] = this.filtersData[option.key] || [];\n    if (isChecked) {\n      this.filtersData[option.key].push(value);\n      return;\n    }\n    this.filtersData[option.key] = this.filtersData[option.key].filter(val => val != value);\n  }\n\n  render() {\n    return <Host>\n      {this.filters?.map(option => <salla-filters-widget\n        option={option}\n        filtersData={this.filtersData}\n        onChanged={({ detail: { event, option, value } }) => this.handleOptionChange(event, option, value)} />)}\n\n      {this.filters?.length && <div class=\"s-filters-footer\">\n        <salla-button color='primary' onClick={() => this.applyFilters()}>{this.apply}</salla-button>\n        <salla-button color='gray' fill='outline' onClick={() => this.resetFilters()}>{this.reset}</salla-button>\n      </div>}\n    </Host>;\n  }\n\n  componentDidLoad() {\n    this.isReady = true;\n  }\n}\n\n"],"mappings":"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"}