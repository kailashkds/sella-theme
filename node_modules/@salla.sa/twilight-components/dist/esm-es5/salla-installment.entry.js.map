{"version":3,"names":["sallaInstallmentCss","SallaInstallment","hostRef","_this","this","tabbyBorderRemoved","tabbyRemoveBorderTries","salla","config","get","lang","onLoaded","installment","tamaraIsActive","includes","tabbyIsActive","spotiiIsActive","renderInstallments","prototype","render","h","Host","class","price","currency","language","id","script","document","createElement","setAttribute","head","appendChild","onload","window","TamaraProductWidget","init","setTimeout","TabbyPromo","selector","querySelectorAll","forEach","element","removeTabbyBorder","amount","money","Number","toFixed","isRTL","spotiiConfig","targetXPath","renderToPath","numberOfPayment","templateLine","textOne","textTwo","textThree","url","cdn","promo","querySelector","shadowRoot","style"],"sources":["src/components/salla-installment/salla-installment.scss?tag=salla-installment","src/components/salla-installment/salla-installment.tsx"],"sourcesContent":["/*\n  The whole installment methods is a third-party widgets,\n  So there aren't a custom classes (as other components) to style them.\n*/\n\nsalla-installment:empty {\n  display: none;\n}\n/*\n* Installment::Tabby\n*/\n#tabbyPromoWrapper {\n  background: white;\n  border-radius: 0.375rem;\n  transition: box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n  margin-bottom: 20px;\n\n  .salla-y &{\n    border: 1px solid var(--color-grey-dark);\n    border-radius: 12px\n  }\n\n  &:hover{\n    box-shadow: 0 0 #0000, 0 0 #0000, 5px 10px 30px #2B2D340D;\n  }\n\n  #tabbyPromo {\n    * {\n      font-family: var(--font-main);\n    }\n\n    > div > div {\n      max-width: none;\n      //padding: 15px;\n      box-shadow: none;\n      border: none;\n    }\n\n    .tabby-promo-snippet {\n      max-width: 100%;\n      min-height: 100px;\n      padding: 18px 20px;\n      // border-color: var(--color-grey-dark);\n      border: none !important;\n\n\n      &__text, &__link {\n        font-size: var(--font-sm);\n        color: var(--color-text) !important;\n      }\n\n      &__link {\n        font-weight: bold;\n      }\n    }\n  }\n}\n\n.tabby-promo-wrapper {\n  #tabby-promo {\n    font-family: var(--font-main) !important;\n\n    .tabby-promo {\n      &__feature-title {\n        font-size: var(--font-md);\n      }\n\n      &__feature-desc {\n        font-size: var(--font-sm);\n        line-height: 20px;\n      }\n    }\n  }\n}\n\n/*\n* Installment::Tamara & Spotii\n*/\n.tamara-product-widget{\n  margin-bottom: 20px;\n}\n\n.tamara-product-widget,\n.spotii-wrapper {\n  min-height: 100px;\n  position: relative;\n  color: var(--color-text);\n  font-size: var(--font-sm);\n  line-height: 1.25;\n  padding: 18px 20px 18px 100px !important;\n  background: white;\n  border-radius: 0.375rem;\n  transition: box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n\n  .salla-y &{\n    border-radius: 12px;\n    border: 1px solid var(--color-grey-dark);\n  }\n\n  &:hover{\n    box-shadow: 0 0 #0000, 0 0 #0000, 5px 10px 30px #2B2D340D;\n  }\n  .spotii-logo {\n    float: left;\n    margin: 0 0 0 -75px;\n  }\n}\n.ltr .tamara-product-widget,\n.ltr .spotii-wrapper{\n  text-align: left;\n  padding: 18px 100px 18px 20px !important;\n  .spotii-logo {\n    float: right;\n    margin: 0 -75px 0 0;\n  }\n  .spotii-product-widget {\n    text-align: left !important;\n  }\n}\n\n.spotii-wrapper {\n  margin-bottom: 20px;\n  .spotii-promo {\n    font-size: var(--font-md);\n  }\n\n  .spotii-product-widget {\n    font-size: var(--font-sm) !important;\n    margin-top: 10px;\n  }\n}\n\n.tamara-product-widget{\n  .tamara-logo {\n    position: absolute;\n    left: 20px;\n    top: 18px;\n    margin: 0 !important;\n\n    .ltr &{\n      right: 20px;\n      left: auto;\n    }\n  }\n\n  span {\n    font-family: var(--font-main);\n    font-size: var(--font-sm);\n    color: var(--color-text);\n\n    &:last-child {\n      display: block;\n      position: relative;\n      margin-top: 8px;\n    }\n  }\n}\n\n.tamara-popup {\n  &__wrap {\n    overflow: auto !important;\n  }\n}\n","import {Component, Host, h, Prop, State} from '@stencil/core';\n\n@Component({\n  tag: 'salla-installment',\n  styleUrl: 'salla-installment.scss',\n})\n\nexport class SallaInstallment {\n  private tabbyBorderRemoved: boolean = false;\n  private tabbyRemoveBorderTries: number = 0;\n\n  constructor() {\n    salla.lang.onLoaded(() => {\n      const installment = salla.config.get('store.settings.installments');\n      if (installment) {\n        this.tamaraIsActive = installment.includes('tamara_installment');\n        this.tabbyIsActive = installment.includes('tabby_installment');\n        this.spotiiIsActive = installment.includes('spotii_pay');\n      }\n      this.renderInstallments();\n    });\n  }\n\n  /**\n   * Current product price\n   */\n  @Prop() price: string;\n  /**\n   * Language code\n   */\n  @Prop() language: string = salla.config.get('user.language_code');\n  /**\n   * Currency code\n   */\n  @Prop() currency: string = salla.config.get('user.currency_code');\n\n  @State() tamaraIsActive: boolean;\n  @State() tabbyIsActive: boolean;\n  @State() spotiiIsActive: boolean;\n\n  render() {\n    return (\n      <Host>\n        {this.tamaraIsActive ?\n          <div class=\"tamara-product-widget\"\n               data-price={this.price}\n               data-currency={this.currency}\n               data-lang={this.language}\n               data-payment-type=\"installment\">\n          </div>\n          : ''}\n\n        {this.tabbyIsActive ?\n          <div id=\"tabbyPromoWrapper\">\n            <div id=\"tabbyPromo\"></div>\n          </div>\n          : ''}\n\n        {this.spotiiIsActive ?\n          <div class=\"spotii-wrapper\">\n            {/*No need for the price, the price already in the page, and also tammara & tabby doesn't have price */}\n            <div class=\"spotii-promo\"></div>\n          </div>\n          : ''}\n      </Host>\n    );\n  }\n\n  renderInstallments() {\n    // Tamara\n    if (this.tamaraIsActive) {\n      var script = document.createElement('script');\n      script.setAttribute('src', 'https://cdn.tamara.co/widget/product-widget.min.js');\n      document.head.appendChild(script);\n      script.onload = () => {\n        window.TamaraProductWidget.init({lang: this.language})\n        setTimeout(() => {\n          window.TamaraProductWidget.render()\n        }, 300)\n      }\n    }\n\n    // tabby\n    if (this.tabbyIsActive) {\n      var script = document.createElement('script');\n      script.setAttribute('src', 'https://checkout.tabby.ai/tabby-promo.js');\n      document.head.appendChild(script);\n      script.onload = () => {\n        const TabbyPromo = window.TabbyPromo;\n        new TabbyPromo({\n          selector: '#tabbyPromo',\n          currency: this.currency,\n          price: this.price,\n          lang: this.language,\n        });\n        document.querySelectorAll('.tabby-promo-snippet__logo').forEach(function (element) {\n          element.setAttribute('aria-label', 'Tabby Logo')\n        });\n      }\n      //this is workaround to remove the default border and add margin\n      this.removeTabbyBorder();\n    }\n\n    // Spotii\n    if (this.spotiiIsActive) {\n      let amount = salla.money((Number(this.price) / 3).toFixed(2));\n      let isRTL = salla.config.get('theme.is_rtl', true);\n      window.spotiiConfig = {\n        targetXPath: ['.spotii-wrapper'],\n        renderToPath: ['.spotii-promo'],\n        numberOfPayment: 3,\n        currency: this.currency,\n        templateLine: \"${textOne} ${number} ${textTwo} \" + amount + \"${logo} ${info}\",\n        //todo:: translate these\n        textOne: isRTL ? \"جزء الدفع على\" : \"Split it into\",\n        textTwo: isRTL ? \"أقساط متساوية بدون تكاليف اضافية بقيمة\" : \"payments of\",\n        textThree: \"مع\",\n        price: this.price,\n        // forcedShow: false,\n        // merchantID: null,\n      }\n\n      var script = document.createElement('script');\n\n      script.setAttribute('src', salla.url.cdn('js/price-widget-ar-salla.js'));\n      document.head.appendChild(script);\n      // script.onload = () => {\n      //   // setTimeout()\n      // }\n    }\n\n  }\n\n  /**\n   * this is workaround to remove the default border and add margin\n   * we will try to remove tabby border 5 times for 7.5 seconds\n   */\n  removeTabbyBorder() {\n    if (this.tabbyBorderRemoved || this.tabbyRemoveBorderTries > 5) {\n      return;\n    }\n    this.tabbyRemoveBorderTries++;\n    setTimeout(() => {\n      let promo: any = document.querySelector('#tabbyPromo>div>div');\n      promo = promo ? promo.shadowRoot.querySelector('div[class^=\"styles__tabby-promo-snippet--\"]') : null;\n      if (promo) {\n        promo.style = 'border: none; margin: 15px 0!important;';\n        this.tabbyBorderRemoved = true;\n      } else {\n        this.removeTabbyBorder();\n      }\n    }, this.tabbyRemoveBorderTries * 500)\n  }\n}\n"],"mappings":";;;mEAAA,IAAMA,oBAAsB,ovG,ICOfC,iBAAgB,WAI3B,SAAAA,EAAAC,GAAA,IAAAC,EAAAC,K,yBAHQA,KAAAC,mBAA8B,MAC9BD,KAAAE,uBAAiC,E,mCAqBdC,MAAMC,OAAOC,IAAI,sB,cAIjBF,MAAMC,OAAOC,IAAI,sB,yFAtB1CF,MAAMG,KAAKC,UAAS,WAClB,IAAMC,EAAcL,MAAMC,OAAOC,IAAI,+BACrC,GAAIG,EAAa,CACfT,EAAKU,eAAiBD,EAAYE,SAAS,sBAC3CX,EAAKY,cAAgBH,EAAYE,SAAS,qBAC1CX,EAAKa,eAAiBJ,EAAYE,SAAS,a,CAE7CX,EAAKc,oB,IAqBThB,EAAAiB,UAAAC,OAAA,WACE,OACEC,EAACC,KAAI,KACFjB,KAAKS,eACJO,EAAA,OAAKE,MAAM,wBAAuB,aACjBlB,KAAKmB,MAAK,gBACPnB,KAAKoB,SAAQ,YACjBpB,KAAKqB,SAAQ,oBACN,gBAErB,GAEHrB,KAAKW,cACJK,EAAA,OAAKM,GAAG,qBACNN,EAAA,OAAKM,GAAG,gBAER,GAEHtB,KAAKY,eACJI,EAAA,OAAKE,MAAM,kBAETF,EAAA,OAAKE,MAAM,kBAEX,G,EAKVrB,EAAAiB,UAAAD,mBAAA,eAAAd,EAAAC,KAEE,GAAIA,KAAKS,eAAgB,CACvB,IAAIc,EAASC,SAASC,cAAc,UACpCF,EAAOG,aAAa,MAAO,sDAC3BF,SAASG,KAAKC,YAAYL,GAC1BA,EAAOM,OAAS,WACdC,OAAOC,oBAAoBC,KAAK,CAAC1B,KAAMP,EAAKsB,WAC5CY,YAAW,WACTH,OAAOC,oBAAoBhB,Q,GAC1B,I,EAKP,GAAIf,KAAKW,cAAe,CACtB,IAAIY,EAASC,SAASC,cAAc,UACpCF,EAAOG,aAAa,MAAO,4CAC3BF,SAASG,KAAKC,YAAYL,GAC1BA,EAAOM,OAAS,WACd,IAAMK,EAAaJ,OAAOI,WAC1B,IAAIA,EAAW,CACbC,SAAU,cACVf,SAAUrB,EAAKqB,SACfD,MAAOpB,EAAKoB,MACZb,KAAMP,EAAKsB,WAEbG,SAASY,iBAAiB,8BAA8BC,SAAQ,SAAUC,GACxEA,EAAQZ,aAAa,aAAc,a,KAIvC1B,KAAKuC,mB,CAIP,GAAIvC,KAAKY,eAAgB,CACvB,IAAI4B,EAASrC,MAAMsC,OAAOC,OAAO1C,KAAKmB,OAAS,GAAGwB,QAAQ,IAC1D,IAAIC,EAAQzC,MAAMC,OAAOC,IAAI,eAAgB,MAC7CyB,OAAOe,aAAe,CACpBC,YAAa,CAAC,mBACdC,aAAc,CAAC,iBACfC,gBAAiB,EACjB5B,SAAUpB,KAAKoB,SACf6B,aAAc,mCAAqCT,EAAS,kBAE5DU,QAASN,EAAQ,gBAAkB,gBACnCO,QAASP,EAAQ,yCAA2C,cAC5DQ,UAAW,KACXjC,MAAOnB,KAAKmB,OAKd,IAAII,EAASC,SAASC,cAAc,UAEpCF,EAAOG,aAAa,MAAOvB,MAAMkD,IAAIC,IAAI,gCACzC9B,SAASG,KAAKC,YAAYL,E,GAY9B1B,EAAAiB,UAAAyB,kBAAA,eAAAxC,EAAAC,KACE,GAAIA,KAAKC,oBAAsBD,KAAKE,uBAAyB,EAAG,CAC9D,M,CAEFF,KAAKE,yBACL+B,YAAW,WACT,IAAIsB,EAAa/B,SAASgC,cAAc,uBACxCD,EAAQA,EAAQA,EAAME,WAAWD,cAAc,+CAAiD,KAChG,GAAID,EAAO,CACTA,EAAMG,MAAQ,0CACd3D,EAAKE,mBAAqB,I,KACrB,CACLF,EAAKwC,mB,IAENvC,KAAKE,uBAAyB,I,WAhJR,G"}